ymaps.modules.define("setCenter",["util.array","util.objectKeys","getPolesOfInaccessibility","parseZoomData"],function(t,e,o,n,i){t(function(t,a,l){var r=n(a,1);if(t.autoCenter=r.center,t.polygonIndex=r.index,e.isArray(l))o(t.zoomInfo).forEach(function(e){t.zoomInfo[e].center=l});else if("[object Object]"===Object.prototype.toString.call(l)){var s=i(l);o(s).forEach(function(e){void 0!==s[e]&&(t.zoomInfo[e].center=s[e])})}})}),ymaps.modules.define("config",[],function(t){t({MIN_ZOOM:0,MAX_ZOOM:19,options:["labelLayout","labelDotLayout","labelClassName","labelForceVisible","labelTextColor","labelTextSize","labelCenterCoords"],properties:[]})}),ymaps.modules.define("Label",["util.extend","Placemark","XPlacemark","createLabelLayoutTemplate"],function(t,e,o,n,i){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(o,n,i,l){if(a(this,t),!o||!l)throw new Error("wrong argument");this._geoObject=o,this._parentCollection=l,this._options=e({},n),this._properties=e({},i),this._label=null,this._size={width:0,height:0},this._initLabel()}return t.prototype.getPlacemark=function(){return this._label},t.prototype._calculateLabelSize=function(o){this.removeFromCollection();var n=o.height/2,i=o.width/2;this._setSize(o),this._label=t._createPlacemark({options:e({},this._label.options.getAll(),{iconShape:{type:"Rectangle",coordinates:[[-i,-n],[i,n]]},iconTop:-n,iconLeft:-i})}),this.addToCollection()},t.prototype._setSize=function(t){this._size.width=t.width,this._size.height=t.height},t.prototype.removeFromCollection=function(){if(!this._parentCollection||-1===this._parentCollection.indexOf(this._label))return!1;this._parentCollection.remove(this._label)},t.prototype.addToCollection=function(){if(!this._parentCollection)return!1;this._parentCollection.add(this._label)},t.prototype._initLabel=function(){var e=this._options.labelLayout;e=i(e),this._label=t._createPlacemark({properties:this._properties,options:this._options},e),this._label.properties.set("labelPolygon",this._geoObject)},t._createPlacemark=function(t,i){var a=t.properties,l=t.options;return l=e({},{iconLayout:i,iconLabelPosition:"absolute",pointOverlay:n},l),new o([0,0],a,l)},t.prototype._setCoordinates=function(t){t!==this._label.geometry.getCoordinates()&&this._label.geometry.setCoordinates(t)},t.prototype._setVisibility=function(t){var e=t?"places":"phantom";this._label.options.get("pane")!==e&&this._label.options.set({pane:e})},t.prototype._setStyles=function(t){var e=t.className,o=t.textColor,n=t.textSize;this._options.labelTextSize=n,this._options.labelTextColor=o,this._options.labelTextClassName=e,t.size&&(this._size.height=t.size.height||this._size.height,this._size.width=t.size.width||this._size.width),this._label.options.set(this._getTextLabelOption())},t.prototype._getTextLabelOption=function(){var t=this._options,e=t.labelTextClassName,o=t.labelTextColor,n=t.labelTextSize,i=this._size,a=i.width,l=i.height;return{iconLabelClassName:this._isObject(e)?"":e,iconLabelText:this._properties.labelText||"",iconLabelTextSize:this._isObject(n)?"":n,iconLabelTextColor:this._isObject(o)?"":o,iconTop:-l/2,iconLeft:-a/2}},t.prototype._isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},t.prototype.destroy=function(){this.removeFromCollection(),this._label=void 0},t}())}),ymaps.modules.define("LabelForCollection",["util.extend","util.objectKeys","Placemark","XPlacemark","createLabelLayoutTemplate","createDotLayoutTemplate","getLabelLayout"],function(t,e,o,n,i,a,l,r){function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(o,n,i,a){if(s(this,t),!o||!a)throw new Error("wrong argument");this._polygon=o,this._parentCollection=a,this._options=e({},n),this._properties=e({},i),this._placemark={label:null,dot:null},this._layout={label:null,dot:null},this._size={label:{w:0,h:0},dot:{w:0,h:0}},this._init()}return t.prototype.getPlacemark=function(){return this._placemark},t.prototype.getLayout=function(){return this._layout},t.prototype._saveSize=function(t,e){this._size[t]={w:e.width,h:e.height}},t.prototype.removeFromCollection=function(t){var e=this;t.forEach(function(t){e._parentCollection&&-1!==e._parentCollection.indexOf(e._placemark[t])&&e._parentCollection.remove(e._placemark[t])})},t.prototype.addToCollection=function(t){var e=this;return new Promise(function(o,n){if(e._parentCollection){var i=[];t.forEach(function(t){e._parentCollection.add(e._placemark[t]),i.push(new Promise(function(o){r(e._placemark[t]).then(function(n){e._layout[t]=n,o()})}))}),Promise.all(i).then(function(){o()})}else n()})},t.prototype._init=function(){var o=this._options,n=o.labelLayout,i=o.labelDotLayout;n=a(n),i=l(i),this._placemark.label=t._createPlacemark({properties:e(this._properties,{_labelPolygon:this._polygon}),options:this._options},n),this._placemark.dot=t._createPlacemark({properties:e(this._properties,{_labelPolygon:this._polygon})},i)},t._createPlacemark=function(t,o){var a=t.properties,l=t.options;return l=e({},{iconLayout:o,iconLabelPosition:"absolute",pointOverlay:i},l),new n([0,0],a,l)},t.prototype._setLayoutTemplate=function(t,e){var o=this,n={label:a,dot:l};return Promise.all(t.map(function(t,i){var a=n[t](e[i]);o._placemark[t].options.set({iconLayout:a})}))},t.prototype._setCoordinates=function(t){var e=this;t!==this._placemark.label.geometry.getCoordinates()&&["dot","label"].forEach(function(o){e._placemark[o].geometry.setCoordinates(t)})},t.prototype._setVisibility=function(t){var e=this;o(this._placemark).forEach(function(o){var n=o===t?"places":"phantom";e._placemark[o].options.set({pane:n})})},t.prototype._setStyles=function(t){var e=t.className,o=t.textColor,n=t.textSize;this._options.labelTextSize=n,this._options.labelTextColor=o,this._options.labelTextClassName=e,this._placemark.label.options.set(this._getLabelStyleOption("label"))},t.prototype._setSize=function(t,o){var n=o.height/2,i=o.width/2;this._saveSize(t,o),this._placemark[t].options.set(e({},{iconShape:{type:"Rectangle",coordinates:[[-i,-n],[i,n]]}},this._getLabelStyleOption(t)))},t.prototype._getLabelStyleOption=function(t){var e=this._options,o=e.labelTextClassName,n=e.labelTextColor,i=e.labelTextSize,a=this._size[t],l=a.w,r=a.h;return{iconLabelClassName:this._isObject(o)?"":o,iconLabelTextSize:this._isObject(i)?"":i,iconLabelTextColor:this._isObject(n)?"":n,iconLabelTop:-r/2,iconLabelLeft:-l/2}},t.prototype._isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},t.prototype.destroy=function(){this.removeFromCollection(["dot","label"])},t}())}),ymaps.modules.define("LabelForObjectManager",["util.extend","GeoObject","stringReplacer","ObjectManager","Placemark","transformGeoObjectToObject"],function(t,e,o,n,i,a,l){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(e,o,n,i){if(r(this,t),!e||!n)throw new Error("wrong argument");this._geoObject=e,this._parentCollection=i,this._options=o,this._label=null,this._id=null,this._LayoutClass=n,this._initLabel()}return t.prototype.getPlacemark=function(){return this._label},t.prototype.calculateLabelSize=function(o){this.removeFromCollection();var n=o.height/2,i=o.width/2;this._label=t._createPlacemark({properties:e({},this._label.properties.getAll(),{top:-n,left:-i}),options:e({},this._label.options.getAll(),{iconShape:{type:"Rectangle",coordinates:[[-i,-n],[i,n]]}})},this._LayoutClass),this.addToCollection()},t.prototype.removeFromCollection=function(){if(!this._parentCollection)return!1;this._parentCollection instanceof i&&this._id?this._parentCollection.remove(l(this._label,this._id)):this._parentCollection.remove(this._label)},t.prototype.addToCollection=function(){if(!this._parentCollection)return!1;if(this._parentCollection instanceof i){var t="PolygonLabel#"+this._geoObject.id;return this._parentCollection.add(l(this._label,t)),this._id=t,t}this._parentCollection.add(this._label)},t.prototype._initLabel=function(){var e=this._options.labelHtml,o=void 0;o=e||this._createLabelContentWithPresets(),this._label=t._createPlacemark({properties:{html:o},options:this._options},this._LayoutClass)},t._createPlacemark=function(t,o){var n=t.properties,i=t.options;return n=e({},{top:0,left:0,position:"absolute"},n),i=e({},{iconLayout:o},i),new a([0,0],n,i)},t.prototype._createLabelContentWithPresets=function(){var t=this._options,e=t.labelText,o=t.labelTextClassName,i=t.labelTextSize,a=t.outlineColor,l=t.textColor;return n('<div class="$1" style="font-size: $2; color: $3; text-shadow: $4">$5</div>',[o,i,l,"\n        1px 1px 0 "+a+",\n        -1px -1px 0 "+a+",\n        1px -1px 0 "+a+",\n        -1px 1px 0 "+a,e])},t.prototype._initEvents=function(){},t.prototype._labelClick=function(){this._geoObject instanceof o&&this._geoObject.events.fire("labelClick",{targetLabel:this._label})},t.prototype._removeClickEvent=function(){this._label.events.remove("click",this._labelClick,this)},t.prototype.destroy=function(){this._removeClickEvent(),this.removeFromCollection(),this._label=void 0},t}())}),ymaps.modules.define("createDotLayoutTemplate",["templateLayoutFactory"],function(t,e){t(function(t){return void 0===t&&(t="<div {% style %}background-color: red; width: 10px; height: 10px; border-radius: 50px;{% endstyle %}></div>"),e.createClass("\n    <div {% style %}position: {{options.labelPosition}}; top: {{options.labelTop}}px; left: {{options.labelLeft}}px; {% endstyle %}>\n        "+t+"\n    </div>")})}),ymaps.modules.define("createLabelLayoutTemplate",["templateLayoutFactory"],function(t,e){t(function(t){return e.createClass('\n    <div {% style %}position: {{options.labelPosition}}; top: {{options.labelTop}}px; left: {{options.labelLeft}}px; {% endstyle %}>\n        <div class="{{options.labelClassName}}"\n            {% style %}font-size: {{options.labelTextSize}}px; color: {{options.labelTextColor}}; {% endstyle %}>\n            '+t+"\n        </div>\n    </div>")})}),ymaps.modules.define("LabelLayoutTemplate",["templateLayoutFactory","config"],function(t,e,o){t(e.createClass(""))}),ymaps.modules.define("PBased",["config","GeoObject","option.presetStorage"],function(t,e,o,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(e){i(this,t),this._map=e}return t.prototype.initMapListeners=function(t){this._mapBoundsChangeCallback=t,this._map.events.add("boundschange",this._mapBoundsChangeHandler,this)},t.prototype.destroyMapListeners=function(){this._map.events.remove("boundschange",this._mapBoundsChangeHandler,this)},t.prototype._mapBoundsChangeHandler=function(t){t.get("newZoom")!==t.get("oldZoom")&&this._mapBoundsChangeCallback()},t.prototype.getOptions=function(t){return e.options.reduce(function(e,n){return e[n]=t instanceof o?t.options.get(n):t.options[n],e},{})},t.prototype.getProperties=function(t){return e.properties.reduce(function(e,n){return e[n]=t instanceof o?t.properties.get(n):t.properties[n],e},{})},t}())}),ymaps.modules.define("PCollection",["util.defineClass","util.objectKeys","PBased","config","LabelForCollection","setCenter","setZoomVisibilityForGeoObject","setForceVisibleZoom","parseZoomData","createDefaultLabelData","GeoObjectCollection","data.Manager","Monitor","system.nextTick"],function(t,e,o,n,i,a,l,r,s,c,p,u,h,f,b){function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function y(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}t(function(t){function n(e,o){d(this,n);var i=y(this,t.call(this,e));return i._map=e,i._labelsCollection=new u,i._labelsState=new WeakMap,i._polygonsCollection=o,i._currentConfiguredVisibility=new WeakMap,i._currentVisibility=new WeakMap,i._initData(),i}return e(n,t),n.prototype.destroy=function(){this._deleteLabelStateListeners(),this._deletePolygonsListeners(),this._deletePolygonCollectionListeners(),this._clearLabelCollection(),this._map.geoObjects.remove(this._labelsCollection)},n.prototype.getLabelState=function(t){return this._labelsState.get(t)},n.prototype.getConfiguredVisibility=function(t){return this._currentConfiguredVisibility.get(t)},n.prototype.getCurrentVisibility=function(t){return this._currentVisibility.get(t)},n.prototype._initData=function(){var t=this;this._map.geoObjects.add(this._labelsCollection),this._calculateCollections(!0).then(function(){t._initMapListeners(),t._initPolygonCollectionListeners(),t._initPolygonsListeners()})},n.prototype._calculateCollections=function(t){var e=this,o=[];return t&&this._clearLabelCollection(),this._polygonsCollection.each(function(n){t?(e._setLabelState(n,"visible",void 0),e._initLabelStateListener(n),e._calculatePolygonLabelData(n).then(function(t){e._setLabelState(n,"_labelData",t),o.push(e._analyzeAndSetLabelData(e._map,n,e._getLabelState(n,"_labelData")))})):o.push(e._analyzeAndSetLabelData(e._map,n,e._getLabelState(n,"_labelData")))}),Promise.all(o)},n.prototype._clearLabelCollection=function(){this._labelsCollection.removeAll(),this._labelsCollection.options.set({pane:"phantom"})},n.prototype._calculatePolygonLabelData=function(t,e){var n=this,i=this.getOptions(t),u=this.getProperties(t),h=p();s(h,i.labelForceVisible);var f=t.geometry.getCoordinates();l(h,f,i.labelCenterCoords);var b=void 0;return b=e?this._getLabelState(t,"_labelData").label:new a(t,i,u,this._labelsCollection),h.label=b,new Promise(function(t){b.addToCollection(["dot","label"]).then(function(){var e=i.labelClassName,a=i.labelTextColor,l=i.labelTextSize;e=c(e),l=c(l),a=c(a),o(h.zoomInfo).forEach(function(t){h.zoomInfo[t].style={className:e?e[t]:"",textSize:l?l[t]:"",textColor:a?a[t]:""}}),r(n._map,h,f[h.polygonIndex],b).then(function(){t(h)})})})},n.prototype._analyzeAndSetLabelData=function(t,e,o,n){var i=this;return new Promise(function(a){if(o){var l=o.zoomInfo,r=o.autoCenter,s=o.label;l=l[t.getZoom()],i._setCurrentConfiguredVisibility(e,l.visible,l.visibleForce),s._setCoordinates(l.center||r);var c="auto"===(n=n||l.visibleForce)?l.visible:n;i._setCurrentVisibility(e,c),s._setVisibility(c),["dot","label"].includes(n)&&s._setSize(n,"dot"===n?o.dotSize:l.labelSize),s._setStyles(l.style),a()}else a()})},n.prototype._setCurrentConfiguredVisibility=function(t,e,o){var n=o&&["dot","label","none"].includes(o)?o:e;this._currentConfiguredVisibility.set(t,n)},n.prototype._setCurrentVisibility=function(t,e){this._currentVisibility.set(t,["dot","label"].includes(e)?e:"none")},n.prototype._recalculateNewPolygon=function(t){var e=this;this._calculatePolygonLabelData(t).then(function(o){e._setLabelState(t,"_labelData",o),e._analyzeAndSetLabelData(e._map,t,e._getLabelState(t,"_labelData"))})},n.prototype._setLabelState=function(t,e,o){var n=this._labelsState.get(t);n||(n=new h,this._labelsState.set(t,n)),n.set(e,o)},n.prototype._getLabelState=function(t,e){var o=this._labelsState.get(t);if(o)return o.get(e)},n.prototype._clearVisibilityInLabelsState=function(){var t=this;this._polygonsCollection.each(function(e){t._setLabelState(e,"visible",void 0)})},n.prototype._polygonCollectionEventHandler=function(t){switch(t.get("type")){case"add":this._recalculateNewPolygon(t.get("child"));break;case"remove":this._getLabelState(t.get("child"),"_labelData").label.destroy()}},n.prototype._deleteLabelStateListeners=function(){var t=this;this._polygonsCollection.each(function(e){t._deleteLabelStateListener(e)})},n.prototype._deleteLabelStateListener=function(t){var e=this._getLabelState(t,"labelMonitor");e&&e.removeAll()},n.prototype._initLabelStateListener=function(t){var e=this,o=new f(this._labelsState.get(t));this._setLabelState(t,"labelMonitor",o),o.add("visible",function(o){e._analyzeAndSetLabelData(e._map,t,e._getLabelState(t,"_labelData"),o)})},n.prototype._initPolygonsListeners=function(){var t=this;this._polygonsCollection.each(function(e){t._initPolygonListener(e)})},n.prototype._initPolygonListener=function(t){t.events.add(["optionschange","propertieschange"],this._onPolygonOptionsChangeHandler,this),t.events.add("parentchange",this._onPolygonParentChangeHandler,this)},n.prototype._onPolygonParentChangeHandler=function(t){this._isPolygonParentChange=!0},n.prototype._onPolygonOptionsChangeHandler=function(t){var e=this;b(function(){if(!e._isPolygonParentChange){var o=t.get("target");e._getLabelState(o,"_labelData").label._setLayoutTemplate(["label","dot"],[o.options.get("labelLayout"),o.options.get("labelDotLayout")]).then(function(){e._calculatePolygonLabelData(o,!0).then(function(t){e._setLabelState(o,"_labelData",t),e._analyzeAndSetLabelData(e._map,o,e._getLabelState(o,"_labelData"))})})}e._isPolygonParentChange=!1})},n.prototype._initPolygonCollectionListeners=function(){this._polygonsCollection.events.add(["add","remove"],this._polygonCollectionEventHandler,this)},n.prototype._initMapListeners=function(){var t=this;this.initMapListeners(function(){t._clearVisibilityInLabelsState(),t._calculateCollections()})},n.prototype._deletePolygonCollectionListeners=function(){this._polygonsCollection.events.remove(["add","remove"],this._polygonCollectionEventHandler,this),this.destroyMapListeners()},n.prototype._deletePolygonsListeners=function(){var t=this;this._polygonsCollection.each(function(e){t._deletePolygonListener(e)})},n.prototype._deletePolygonListener=function(t){t.events.remove(["optionschange","propertieschange"],this._onPolygonOptionsChangeHandler,this),t.events.remove("parentchange",this._onPolygonParentChangeHandler,this)},n}(n))}),ymaps.modules.define("PObjectManager",["util.defineClass","PBased","CalculatorGeoObjectLabelData","LabelLayoutTemplate"],function(t,e,o,n,i){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}t(function(t){function o(e,n){a(this,o);var r=l(this,t.call(this,e));return r._map=e,r._objectManager=n,r._labelLayoutTemplate=i,r._initData(),r}return e(o,t),o.prototype.update=function(){},o.prototype.destroy=function(){},o.prototype.getLabels=function(){},o.prototype._initData=function(){var t=this;this._calculatorGeoObjectLabelData=new n(this._map,this._labelLayoutTemplate,this._objectManager),this._calculatorGeoObjectLabelData.initListenersForObjectManager(),this._calculateCollections(!0).then(function(){t._initMapListeners()})},o.prototype._calculateCollections=function(t){var e=this,o=[];return this._objectManager.objects.each(function(n){t?("string"!=typeof n.id||"string"==typeof n.id&&-1===n.id.indexOf("PolygonLabel"))&&e._calculateGeoObjectLabelData(n).then(function(){o.push(analyzeAndSetLabelData(e._map,n))}):o.push(analyzeAndSetLabelData(e._map,n))}),Promise.all(o)},o.prototype._calculateGeoObjectLabelData=function(e){var o=this,n=t.prototype.getOptions.call(this,e),i=t.prototype.getProperties.call(this,e);return new Promise(function(t){o._calculatorGeoObjectLabelData.getLabelData(e,n,i,o._objectManager).then(function(o){e.properties._labelData=o,t()})})},o.prototype._initMapListeners=function(){t.prototype.initMapListeners.call(this,function(){})},o}(o))}),ymaps.modules.define("Polylabel",["PCollection","PObjectManager","ObjectManager"],function(t,e,o,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(a,l){i(this,t),this._instance=l instanceof n?new o(a,l):new e(a,l)}return t.prototype.getLabelState=function(t){return this._instance.getLabelState(t)},t.prototype.getConfiguredVisibility=function(t){return this._instance.getConfiguredVisibility(t)},t.prototype.getCurrentVisibility=function(t){return this._instance.getCurrentVisibility(t)},t.prototype.destroy=function(){this._instance.destroy()},t}())}),ymaps.modules.define("CalculatorGeoObjectLabelData",["GeoObject","ObjectManager","createDefaultLabelData","setCenter","setZoomVisibility","Label"],function(t,e,o,n,i,a,l){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(e,o,n){r(this,t),this._map=e,this._LabelLayoutTemplate=o,this._data=n,this._storage={}}return t.prototype.getLabelData=function(t,r,s,c){var p=this,u=n(),h=t instanceof e?t.geometry.getCoordinates():t.geometry.coordinates;i(u,h,s.labelCenterCoords);var f=new l(t,r,this._LabelLayoutTemplate,c),b=f.addToCollection();return new Promise(function(t){c instanceof o?b&&(p._storage[b]={resolve:t,labelData:u,labelInst:f,coordinates:h,options:r}):f.getPlacemark().getOverlay().then(function(t){return t.getLayout()}).then(function(e){var o=e.getElement().firstChild.getBoundingClientRect();f.calculateLabelSize(o),f._initEvents(),a(map,u,h,o,r.labelForceVisibleZoom),u.label=f,t(u)})})},t.prototype.removeListenersForObjectManager=function(){this._data.objects.overlays.events.remove("add",this._listenersForOM,this)},t.prototype.initListenersForObjectManager=function(){this._overlaysListener||(this._data.objects.overlays.events.add("add",this._listenersForOM,this),this._data.objects.overlays.events.add("remove",function(t){console.log("remove")},this),this._overlaysListener=!0)},t.prototype._listenersForOM=function(t){console.log("add");var e=t.get("objectId");if("string"==typeof e&&0===e.indexOf("PolygonLabel#")){var o=t.get("overlay");this._storage[e].overlay=o,o.events.add("mapchange",this._mapChangeHandler,{context:this,objectId:e})}},t.prototype._mapChangeHandler=function(t){var e=this;this.context._storage[this.objectId].overlay.getLayout().then(function(t){var o=t.getElement().firstChild.getBoundingClientRect(),n=e.context._storage[e.objectId],i=n.resolve,l=n.labelData,r=n.labelInst,s=n.coordinates,c=n.options,p=n.overlay;r.calculateLabelSize(o),r._initEvents(),a(e.context._map,l,s,o,c.labelForceVisibleZoom),l.label=r,i(l),delete e.context._storage[e.objectId],p.events.remove("mapchange",e.context._mapChangeHandler,e)})},t}())}),ymaps.modules.define("getLabelLayout",[],function(t){t(function(t){return t.getOverlay().then(function(t){return t.getLayout()})})}),ymaps.modules.define("getLabelSize",[],function(t){t(function(t){return t.getElement().firstChild.getBoundingClientRect()})}),ymaps.modules.define("getLayoutSize",[],function(t){t(function(t){var e=t.getElement();return"#text"!==e.firstChild.nodeName?e.firstChild.getBoundingClientRect():e.lastChild.getBoundingClientRect()})}),ymaps.modules.define("transformGeoObjectToObject",[],function(t){t(function(t,e){return{id:e,type:"Feature",geometry:{type:t.geometry.getType(),coordinates:t.geometry.getCoordinates()},options:t.options.getAll(),properties:t.properties.getAll()}})}),ymaps.modules.define("XPlacemark",["util.defineClass","overlay.Placemark"],function(t,e,o){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}t(function(t){function o(e,a,l){return n(this,o),i(this,t.call(this,e,a,l))}return e(o,t),o.prototype.getData=function(){var t=this._data.geoObject.properties.get("_labelPolygon");return t.options.get("labelLayout").indexOf("qweqwe"),{geoObject:t,geometry:t.geometry,properties:t.properties,options:t.options,state:t.state}},o}(o))}),ymaps.modules.define("setPresets",["util.extend","option.presetStorage"],function(t,e,o){function n(t){var o=["Big","Small"],n=["BlackInWhiteOutline","WhiteInBlackOutline"];o.forEach(function(o){t.add(""+r+o,e({},l[o]))}),n.forEach(function(o){t.add(""+r+o,e({},l[o]))}),o.forEach(function(o){n.forEach(function(n){t.add(""+r+o+n,e({},l[o],l[n]))})})}function i(t){return{labelTextSize:t}}function a(t,e){return{textColor:t,outlineColor:e}}var l={Big:i("20px"),Small:i("12px"),BlackInWhiteOutline:a("black","white"),WhiteInBlackOutline:a("white","black")},r="polylabel#";t(function(){o.add("polylabel#default",e({},i("16px"),a("black"))),n(o)})}),ymaps.modules.define("util.createPolylabel",["Polylabel"],function(t,e){t(function(t,o){return new e(t,o)})}),ymaps.modules.define("checkPointPosition",[],function(t){function e(t,e,a){var l=o(a,e),r=o(t,e),s=l[0]*r[1]-r[0]*l[1];return s>0?"LEFT":s<0?"RIGHT":l[0]*r[0]<0||l[1]*r[1]<0?"BEHIND":n(l)<n(r)?"BEYOND":i(e,t)?"ORIGIN":i(a,t)?"DESTINATION":"BETWEEN"}function o(t,e){return[t[0]-e[0],t[1]-e[1]]}function n(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}function i(t,e){return t[0]===e[0]&&t[1]===e[1]}function a(t,o){var n=o[0],i=o[1];switch(e(t,n,i)){case"LEFT":return n[1]<t[1]&&t[1]<=i[1]?"CROSSING":"INESSENTIAL";case"RIGHT":return i[1]<t[1]&&t[1]<=n[1]?"CROSSING":"INESSENTIAL";case"BETWEEN":case"ORIGIN":case"DESTINATION":return"TOUCHING";default:return"INESSENTIAL"}}t(function(t,e){for(var o=0,n=0;n<e.length-1;n++)switch(a(t,[e[n],e[n+1]])){case"TOUCHING":return"BOUNDARY";case"CROSSING":o=1-o}return o?"INSIDE":"OUTSIDE"})}),ymaps.modules.define("createDefaultLabelData",["config"],function(t,e){var o=e.MIN_ZOOM,n=e.MAX_ZOOM;t(function(){for(var t=o,e={zoomInfo:{},autoCenter:[0,0],polygonIndex:0,dotSize:{height:0,width:0}};t<=n;)e.zoomInfo[t]={visible:"none",visibleForce:"auto",center:void 0,style:{className:void 0,textSize:void 0,textColor:void 0},labelSize:{height:0,width:0}},t++;return e})}),ymaps.modules.define("getPolesOfInaccessibility",["util.calculateArea"],function(t,e){function o(t,e){if(!(this instanceof o))return new o(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||n,this.length>0)for(var i=this.length>>1;i>=0;i--)this._down(i)}function n(t,e){return t<e?-1:t>e?1:0}function i(t,e,o){e=e||1;for(var n,i,r,c,u=0;u<t[0].length;u++){var h=t[0][u];(!u||h[0]<n)&&(n=h[0]),(!u||h[1]<i)&&(i=h[1]),(!u||h[0]>r)&&(r=h[0]),(!u||h[1]>c)&&(c=h[1])}var f=r-n,b=c-i,d=Math.min(f,b),y=d/2,_=new p(null,a);if(0===d)return[n,i];for(var g=n;g<r;g+=d)for(var m=i;m<c;m+=d)_.push(new l(g+y,m+y,y,t));var v=s(t),C=new l(n+f/2,i+b/2,0,t);C.d>v.d&&(v=C);for(var L=_.length;_.length;){var S=_.pop();S.d>v.d&&(v=S,o&&console.error("found best %d after %d probes",Math.round(1e4*S.d)/1e4,L)),S.max-v.d<=e||(y=S.h/2,_.push(new l(S.x-y,S.y-y,y,t)),_.push(new l(S.x+y,S.y-y,y,t)),_.push(new l(S.x-y,S.y+y,y,t)),_.push(new l(S.x+y,S.y+y,y,t)),L+=4)}return o&&(console.error("num probes: "+L),console.error("best distance: "+v.d)),[v.x,v.y]}function a(t,e){return e.max-t.max}function l(t,e,o,n){this.x=t,this.y=e,this.h=o,this.d=r(t,e,n),this.max=this.d+this.h*Math.SQRT2}function r(t,e,o){for(var n=!1,i=1/0,a=0;a<o.length;a++)for(var l=o[a],r=0,s=l.length,p=s-1;r<s;p=r++){var u=l[r],h=l[p];u[1]>e!=h[1]>e&&t<(h[0]-u[0])*(e-u[1])/(h[1]-u[1])+u[0]&&(n=!n),i=Math.min(i,c(t,e,u,h))}return(n?1:-1)*Math.sqrt(i)}function s(t){for(var e=0,o=0,n=0,i=t[0],a=0,r=i.length,s=r-1;a<r;s=a++){var c=i[a],p=i[s],u=c[0]*p[1]-p[0]*c[1];o+=(c[0]+p[0])*u,n+=(c[1]+p[1])*u,e+=3*u}return 0===e?new l(i[0][0],i[0][1],0,t):new l(o/e,n/e,0,t)}function c(t,e,o,n){var i=o[0],a=o[1],l=n[0]-i,r=n[1]-a;if(0!==l||0!==r){var s=((t-i)*l+(e-a)*r)/(l*l+r*r);s>1?(i=n[0],a=n[1]):s>0&&(i+=l*s,a+=r*s)}return l=t-i,r=e-a,l*l+r*r}t(function(t,o,n){if(void 0===e)throw new Error("Didn't find calculateArea module");var a=Number.MIN_VALUE,l=0,r=void 0;if(t.length>1){for(var s=0;s<t.length;s++){var c=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:[t[s]]}}),p=Math.round(e(c));a<p&&(a=p,l=s)}r=[t[l]]}else r=t;return{center:i(r,o,n),index:l}}),o.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return--this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,o=this.compare,n=e[t];t>0;){var i=t-1>>1,a=e[i];if(o(n,a)>=0)break;e[t]=a,t=i}e[t]=n},_down:function(t){for(var e=this.data,o=this.compare,n=this.length>>1,i=e[t];t<n;){var a=1+(t<<1),l=a+1,r=e[a];if(l<this.length&&o(e[l],r)<0&&(a=l,r=e[l]),o(r,i)>=0)break;e[t]=r,t=a}e[t]=i}};var p=o}),ymaps.modules.define("stringReplacer",[],function(t){t(function(t,e){var o=t;return e.forEach(function(t,e){o=o.replace(new RegExp("\\$"+(e+1),"g"),t)}),o})}),ymaps.modules.define("getFirstZoomInside",["checkPointPosition","config"],function(t,e,o){function n(t,e,o,n){var i=t.options.get("projection").toGlobalPixels(e,o),a=n.width,l=n.height,r=[];return r.push([i[0]-a/2,i[1]-l/2],[i[0]-a/2,i[1]+l/2],[i[0]+a/2,i[1]-l/2],[i[0]+a/2,i[1]+l/2]),r}function i(t,o,n,i){for(var a=0;a<n.length;a++){var l=t.options.get("projection").fromGlobalPixels(n[a],i);if("INSIDE"!==e(l,o))return!1}return!0}t(function(t,e,a,l){for(var r=o.MIN_ZOOM,s=o.MAX_ZOOM,c=void 0;r<s;)i(t,a,n(t,e,c=Math.floor((r+s)/2),l),c)?s=c:r=c+1;return r})}),ymaps.modules.define("parseZoomData",["util.objectKeys","config"],function(t,e,o){function n(t,e,o){t[e]=o}function i(t,e,o){if(isNaN(Number(e))){var n=e.split("_").map(Number);if(!isNaN(n[0])&&!isNaN(n[1]))for(var i=n[0]<r?r:n[0],a=n[1]>s?s:n[1];i<=a;)t[i]=o,i++}else t[Number(e)]=o}function a(t){for(var e=r,o={};e<=s;)o[e]=t,e++;return o}var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=o.MIN_ZOOM,s=o.MAX_ZOOM;t(function(t){var o=["number","string","boolean"];return"[object Object]"===Object.prototype.toString.call(t)?e(t).reduce(function(e,o){return"string"==typeof o?i(e,o,t[o]):"number"==typeof o&&n(e,o,t[o]),e},a()):o.includes(void 0===t?"undefined":l(t))?a(t):void 0})}),ymaps.modules.define("setForceVisibleZoom",["util.objectKeys","parseZoomData"],function(t,e,o){t(function(t,n){if("string"==typeof n)e(t.zoomInfo).forEach(function(e){t.zoomInfo[e].visibleForce=n});else if("[object Object]"===Object.prototype.toString.call(n)){var i=o(n);e(i).forEach(function(e){void 0!==i[e]&&(t.zoomInfo[e].visibleForce=i[e])})}})}),ymaps.modules.define("setZoomVisibility",["util.objectKeys","getFirstZoomInside"],function(t,e,o){t(function(t,n,i,a){var l=o(t,n.autoCenter,i,a);e(n.zoomInfo).forEach(function(e){if(n.zoomInfo[e].center){var r=o(t,n.zoomInfo[e].center,i,a);n.zoomInfo[e].visible=e>=r}else n.zoomInfo[e].visible=e>=l})})}),ymaps.modules.define("setZoomVisibilityForGeoObject",["util.objectKeys","getFirstZoomInside","getLayoutSize","getLabelLayout","setZoomVisibility"],function(t,e,o,n,i,a){function l(t,e,o){var n=["none","dot","label"],i=t;return o&&(i=n.indexOf(e)>n.indexOf(t)?e:t),i}function r(t,n,i,a,r,s){return new Promise(function(r){n._setSize("dot",s);var c=o(t,i.autoCenter,a,s),p=c;e(i.zoomInfo).forEach(function(e){var n=i.zoomInfo[e];p=n.center?o(t,n.center,a,s):c,n.visible=l(n.visible,"dot",e>=p)}),r()})}function s(t,e,i,a,r,s,p){return new Promise(function(u){var h=i.zoomInfo[a],f="label_"+h.style.className+"_"+h.style.textSize;if(p[f])return h.visible=l(h.visible,"label",a>=p[f].firstZoom),h.labelSize=c(p[f].size),void u();e._setStyles(h.style);var b=n(s);e._setSize("label",b),h.labelSize=c(b);var d=o(t,h.center||i.autoCenter,r,b);h.visible=l(h.visible,"label",a>=d),p[f]={firstZoom:d,size:b},u()})}function c(t){return{width:t.width,height:t.height}}t(function(t,o,i,a){var l=[],c={},p=n(a.getLayout().dot);return o.dotSize={width:p.width,height:p.height},l.push(r(t,a,o,i,a.getLayout().dot,p)),e(o.zoomInfo).forEach(function(e){l.push(s(t,a,o,e,i,a.getLayout().label,c))}),Promise.all(l)})});