ymaps.modules.define("src.config",[],function(t){t({MIN_ZOOM:0,MAX_ZOOM:23,options:["labelLayout","labelDotLayout","labelDotVisible"],zoomRangeOptions:["labelClassName","labelForceVisible","labelTextColor","labelTextSize","labelCenterCoords","labelOffset","labelPermissibleInaccuracyOfVisibility"],properties:[]})}),ymaps.modules.define("src.label.GeoObjectCollection.Label",["util.extend","util.objectKeys","Placemark","src.label.util.LabelPlacemarkOverlay","src.label.util.LabelData","src.label.util.layoutTemplates.getBaseLayoutTemplates","src.label.util.layoutTemplates.createLayoutTemplates"],function(t,e,o,n,a,i,l,s){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(e,o,n){r(this,t),this._map=e,this._polygon=o,this._parentCollection=n,this._placemark={label:null,dot:null},this._layout={label:null,dot:null},this._baseLayoutTemplates=null,this._layoutTemplates=null,this._init()}return t.prototype.getPlacemark=function(t){return this._placemark[t]},t.prototype.getLayout=function(t){return this._layout[t]},t.prototype.getOverlay=function(t){return this._overlay[t]},t.prototype.setLayout=function(t,e){this._layout[t]=e},t.prototype.removeFromCollection=function(){var t=this;this._parentCollection&&(["label","dot"].forEach(function(e){-1!==t._parentCollection.indexOf(t._placemark[e])&&t._parentCollection.remove(t._placemark[e])}),this._polygon=null,this._parentCollection=null,this._placemark=null,this._layout=null,this._data=null)},t.prototype.addToCollection=function(){var t=this;if(!this._parentCollection)return Promise.reject();var e=["label","dot"].map(function(e){return t._placemark[e].getParent()||t._parentCollection.add(t._placemark[e]),t.getLabelLayout(e).then(function(o){t._layout[e]=o})});return Promise.all(e)},t.prototype.getLabelLayout=function(t){return this._placemark[t].getOverlay().then(function(t){return t.getLayout()})},t.prototype._init=function(){this._baseLayoutTemplates=l(),this._layoutTemplates=s(this._polygon.options.get("labelLayout"),this._polygon.options.get("labelDotLayout"))},t.prototype.createPlacemarks=function(){var o=this;["label","dot"].forEach(function(n){o._placemark[n]=t._createPlacemark({properties:e({},{polygon:o._polygon},o._polygon.properties.getAll()),options:e({},o._polygon.options.getAll(),o._layoutTemplates[n])},o._baseLayoutTemplates[n])})},t._createPlacemark=function(t,o){var i=e({},{iconLayout:o,pointOverlay:a,iconLabelPosition:"absolute"},t.options);return new n([0,0],t.properties,i)},t.prototype.createLabelData=function(t,e){return this._data=new i(this._polygon,t,e,this._map,this),this._data},t.prototype.getLabelData=function(){return this._data},t.prototype.setDataByZoom=function(t,e){var o=this;["dot","label"].forEach(function(e){if("label"===e){var n=o._data.getStyles(t);o.setStyles({className:n.className,textSize:n.textSize,textColor:n.textColor})}o.setVisibilityForce("none"),o._data.setVisible(t,e,o._layout[e])});var n=this.setVisibility(e,this._data.getVisibility(t),this._data.getData("dotVisible"));return-1!==["label","dot"].indexOf(n)&&this._data.getSize(t,n)&&(this.setCoordinates(this._data.getCenterCoords(t)),this.setCenterAndIconShape(n,this._data.getSize(t,n),this._data.getOffset(t))),{currentVisibleType:n,currentConfiguredVisibileType:this._data.getVisibility(t)}},t.prototype.setLayoutTemplate=function(){var t=this;this._layoutTemplates=s(this._polygon.options.get("labelLayout"),this._polygon.options.get("labelDotLayout")),o(this._layoutTemplates).forEach(function(e){t._placemark[e].options.set(t._layoutTemplates[e])})},t.prototype.setNewOptions=function(t){var e=this;["dot","label"].forEach(function(o){e._placemark[o].options.set(t)})},t.prototype.setCoordinates=function(t){var e=this;t.toString()!==this._placemark.label.geometry.getCoordinates().toString()&&["dot","label"].forEach(function(o){e._placemark[o].geometry.setCoordinates(t)})},t.prototype.setVisibilityForce=function(t){var e=this;o(this._placemark).forEach(function(o){var n=o===t?"places":"phantom";e._placemark[o].options.get("pane")!==n&&e._placemark[o].options.set({pane:n})})},t.prototype.setVisibility=function(t,e,o){var n=t&&"auto"!==t?t:e;return"dot"!==n||o||(n="none"),this.setVisibilityForce(n),n},t.prototype.setStyles=function(t){this._placemark.label.options.set({iconLabelClassName:t.className,iconLabelTextSize:t.textSize,iconLabelTextColor:t.textColor})},t.prototype.setCenterAndIconShape=function(t,e,o){var n=e.height/2,a=e.width/2;this._placemark[t].options.set({iconShape:{type:"Rectangle",coordinates:[[-a+o[0],-n+o[1]],[a+o[0],n+o[1]]]},iconLabelLeft:-a+o[0],iconLabelTop:-n+o[1]})},t.prototype.destroy=function(){this.removeFromCollection()},t}())}),ymaps.modules.define("src.label.ObjectManager.Label",["util.extend","util.objectKeys","src.label.util.LabelPlacemarkOverlay","src.label.util.LabelData","src.label.util.layoutTemplates.getBaseLayoutTemplates","src.label.util.layoutTemplates.createLayoutTemplates"],function(t,e,o,n,a,i,l){function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(e,o,n){s(this,t),this._map=e,this._polygon=o,this._objectManager=n,this._placemark={label:null,dot:null},this._layout={label:null,dot:null},this._baseLayoutTemplates=null,this._layoutTemplates=null,this._init()}return t.prototype.destroy=function(){this.removeFromObjectManager()},t.prototype.getPlacemark=function(t){return this._placemark[t]},t.prototype.getLayout=function(t){return this._layout[t]},t.prototype.addToObjectManager=function(){var t=this;["label","dot"].forEach(function(e){t._objectManager.add(t._placemark[e])})},t.prototype.removeFromObjectManager=function(){var t=this;["label","dot"].forEach(function(e){t._objectManager.remove(t._placemark[e])}),this._polygon=null,this._objectManager=null,this._placemark=null,this._layout=null,this._data=null},t.prototype._init=function(){this._baseLayoutTemplates=i(),this._layoutTemplates=l(this._polygon.options.labelLayout,this._polygon.options.labelDotLayout)},t.prototype.createPlacemarks=function(){var o=this;["label","dot"].forEach(function(n){o._placemark[n]=t._createPlacemark(n+"#"+o._polygon.id,{properties:e({},{polygon:o._polygon},o._polygon.properties),options:e({},o._polygon.options,o._layoutTemplates[n])},o._baseLayoutTemplates[n],o._data.getCenterCoords(o._map.getZoom()))})},t._createPlacemark=function(t,o,a,i){return{type:"Feature",id:t,options:e({},{iconLayout:a,iconLabelPosition:"absolute",overlay:n,pane:"phantom"},o.options),properties:o.properties,geometry:{type:"Point",coordinates:i}}},t.prototype._updateOptions=function(t,e){this._objectManager.objects.setObjectOptions(t,e)},t.prototype.createLabelData=function(t,e){return this._data=new a(this._polygon,t,e,this._map,this),this._data},t.prototype.getLabelData=function(){return this._data},t.prototype.setLayout=function(t,e){this._layout[t]=e},t.prototype.setLayoutTemplate=function(){var t=this;this._layoutTemplates=l(this._polygon.options.labelLayout,this._polygon.options.labelDotLayout),o(this._layoutTemplates).forEach(function(e){t._updateOptions(t._placemark[e].id,t._layoutTemplates[e])})},t.prototype.setNewOptions=function(t){var o=this;["dot","label"].forEach(function(n){e(o._placemark[n].options,t),o._updateOptions(o._placemark[n].id,o._placemark[n].options)})},t.prototype.setDataByZoom=function(t,e,o){var n=this;e.forEach(function(e){if("label"===e){var o=n._data.getStyles(t);n.setStyles({className:o.className,textSize:o.textSize,textColor:o.textColor})}n.setVisibilityForce("none"),n._data.setVisible(t,e,n._layout[e])});var a=this.setVisibility(o,this._data.getVisibility(t),this._data.getData("dotVisible"));return-1!==["label","dot"].indexOf(a)&&this._data.getSize(t,a)&&(this.setCoordinates(this._data.getCenterCoords(t)),this.setCenterAndIconShape(a,this._data.getSize(t,a),this._data.getOffset(t))),{currentVisibleType:a,currentConfiguredVisibileType:this._data.getVisibility(t)}},t.prototype.setCenterAndIconShape=function(t,e,o){var n=e.height/2,a=e.width/2;this._updateOptions(this._placemark[t].id,{iconShape:{type:"Rectangle",coordinates:[[-a+o[0],-n+o[1]],[a+o[0],n+o[1]]]},iconLabelLeft:-a+o[0],iconLabelTop:-n+o[1]})},t.prototype.setCoordinates=function(t){var e=this;t.toString()!==this._placemark.label.geometry.coordinates.toString()&&["dot","label"].forEach(function(o){e._objectManager.remove(e._placemark[o]),e._generateNewPlacemark(o),e._placemark[o].geometry.coordinates=t,e._objectManager.add(e._placemark[o])})},t.prototype.setStyles=function(t){this._updateOptions(this._placemark.label.id,{iconLabelClassName:t.className,iconLabelTextSize:t.textSize,iconLabelTextColor:t.textColor})},t.prototype.setVisibilityForce=function(t){var e=this;o(this._placemark).forEach(function(o){var n=o===t?"places":"phantom",a=e._objectManager.objects.getById(e._placemark[o].id);a&&a.options.pane!==n&&e._updateOptions(e._placemark[o].id,{pane:n})})},t.prototype.setVisibility=function(t,e,o){var n=t&&"auto"!==t?t:e;return"dot"!==n||o||(n="none"),this.setVisibilityForce(n),n},t.prototype._generateNewPlacemark=function(t){this._placemark[t]=e({},this._placemark[t]);var o=this._placemark[t].id;this._placemark[t].id="_"===o[0]?o.slice(1):"_"+o},t}())}),ymaps.modules.define("src.label.util.getLayoutSize",[],function(t){t(function(t){var e=t&&t.getElement();if(e&&(e=e.getElementsByClassName("ymaps-polylabel-view")[0])){var o=e.getBoundingClientRect();return{width:o.width,height:o.height}}})}),ymaps.modules.define("src.label.util.LabelData",["util.objectKeys","src.config","src.util.zoom.parseZoomData","src.util.getPolesOfInaccessibility","src.util.zoom.setZoomVisibility","GeoObject"],function(t,e,o,n,a,i,l){function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var r=o.MIN_ZOOM,c=o.MAX_ZOOM;t(function(){function t(e,o,n,a,i){s(this,t),this._map=a,this._label=i,this._polygon=e,this._data={zoomInfo:{},autoCenter:[0,0],polygonIndex:0,dotVisible:"boolean"!=typeof o.labelDotVisible||o.labelDotVisible},this.parsedOptions=t._parseOptions(n),this._init()}return t.prototype.setData=function(t,e){this._data[t]=e},t.prototype.getData=function(t){return this._data[t]},t.prototype.setZoomInfo=function(t,e,o){this._data.zoomInfo[t][e]=o},t.prototype.getZoomInfo=function(t){return t||"number"==typeof t&&0===t?this._data.zoomInfo[t]:this._data.zoomInfo},t.prototype.getPolygonCoords=function(){return this._polygon instanceof l?this._polygon.geometry.getCoordinates()[this._data.polygonIndex]:this._polygon.geometry.coordinates[this._data.polygonIndex]},t.prototype.getCenterCoords=function(t){return this.parsedOptions.labelCenterCoords&&this.parsedOptions.labelCenterCoords[t]||this._data.autoCenter},t.prototype.getStyles=function(t){return{className:this.parsedOptions.labelClassName&&this.parsedOptions.labelClassName[t],textSize:this.parsedOptions.labelTextSize&&this.parsedOptions.labelTextSize[t],textColor:this.parsedOptions.labelTextColor&&this.parsedOptions.labelTextColor[t]}},t.prototype.getVisibility=function(t){return this.parsedOptions.labelForceVisible&&this.parsedOptions.labelForceVisible[t]||this._data.zoomInfo[t].visible},t.prototype.getOffset=function(t){return this.parsedOptions.labelOffset&&this.parsedOptions.labelOffset[t]||[0,0]},t.prototype.getPermissibleInaccuracyOfVisibility=function(t){return this.parsedOptions.labelPermissibleInaccuracyOfVisibility&&this.parsedOptions.labelPermissibleInaccuracyOfVisibility[t]||0},t.prototype.getSize=function(t,e){return this._data.zoomInfo[t][e+"Size"]},t.prototype.setVisible=function(t,e,o){if(!this._data.zoomInfo[t][e+"Size"]){var n=i(e,this._map,t,this._data.zoomInfo[t].visible,o,this.getCenterCoords(t),this.getPolygonCoords(),this.getOffset(t),this.getPermissibleInaccuracyOfVisibility(t));n&&(this._data.zoomInfo[t].visible=n.visible,this._data.zoomInfo[t][e+"Size"]=n.size)}},t.prototype._init=function(){var e=this._polygon instanceof l?this._polygon.geometry.getCoordinates():this._polygon.geometry.coordinates,o=a(e,1);this._data.autoCenter=o.center,this._data.polygonIndex=o.index;for(var n=r;n<=c;n++)this._data.zoomInfo[n]=t._createDefaultZoomInfo(n)},t._parseOptions=function(t){var o={};return e(t).forEach(function(e){o[e]=n(t[e])}),o},t._createDefaultZoomInfo=function(){return{visible:"none",dotSize:void 0,labelSize:void 0}},t}())}),ymaps.modules.define("src.label.util.LabelPlacemarkOverlay",["util.defineClass","overlay.Placemark","GeoObject"],function(t,e,o,n){function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}t(function(t){function o(e,n,l){return a(this,o),i(this,t.call(this,e,n,l))}return e(o,t),o.prototype.getData=function(){var t=this._data.geoObject instanceof n?this._data.geoObject.properties.get("polygon"):this._data.properties.polygon;return{geoObject:t,properties:t.properties,state:t.state}},o}(o))}),ymaps.modules.define("src.label.util.layoutTemplates.createLayoutTemplates",["templateLayoutFactory"],function(t,e){t(function(t,o){return{label:{iconLabelTemplateLayout:e.createClass(t)},dot:{iconLabelDotTemplateLayout:e.createClass(o||"<div {% style %}background-color: red;\nwidth: 10px; height: 10px; border-radius: 50px;{% endstyle %}></div>")}}})}),ymaps.modules.define("src.label.util.layoutTemplates.dotLayoutTemplate",["templateLayoutFactory"],function(t,e){t(e.createClass('\n    <div class="ymaps-polylabel-view" {% style %}position: {{options.labelPosition}};\n        top: {{options.labelTop}}px; left: {{options.labelLeft}}px; {% endstyle %}>\n            {% include options.labelDotTemplateLayout %}\n        </div>'))}),ymaps.modules.define("src.label.util.layoutTemplates.getBaseLayoutTemplates",["src.label.util.layoutTemplates.labelLayoutTemplate","src.label.util.layoutTemplates.dotLayoutTemplate"],function(t,e,o){t(function(){return{label:e,dot:o}})}),ymaps.modules.define("src.label.util.layoutTemplates.labelLayoutTemplate",["templateLayoutFactory"],function(t,e){t(e.createClass('\n    <div class="ymaps-polylabel-view" {% style %}position: {{options.labelPosition}};\n        top: {{options.labelTop}}px; left: {{options.labelLeft}}px; {% endstyle %}>\n        <div class="{{options.labelClassName}}"\n            {% style %}text-align: center; font-size: {{options.labelTextSize}}px;\n            color: {{options.labelTextColor}}; {% endstyle %}>\n                {% include options.labelTemplateLayout %}\n            </div>\n        </div>'))}),ymaps.modules.define("src.polylabel.PolylabelBase",["src.config","GeoObject"],function(t,e,o){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(e){n(this,t),this._map=e}return t.prototype.initMapListeners=function(t){this._mapBoundsChangeCallback=t,this._map.events.add(["boundschange"],this._mapEventsHandler,this)},t.prototype.destroyMapListeners=function(){this._map.events.remove(["boundschange"],this._mapEventsHandler,this)},t.prototype._mapEventsHandler=function(t){switch(t.get("type")){case"boundschange":t.get("newZoom")!==t.get("oldZoom")&&this._mapBoundsChangeCallback("boundschange")}},t.prototype.getOptions=function(t){return e.options.reduce(function(e,n){return e[n]=t instanceof o?t.options.get(n):t.options[n],e},{})},t.prototype.getZoomRangeOptions=function(t){return e.zoomRangeOptions.reduce(function(e,n){return e[n]=t instanceof o?t.options.get(n):t.options[n],e},{})},t.prototype.getProperties=function(t){return e.properties.reduce(function(e,n){return e[n]=t instanceof o?t.properties.get(n):t.properties[n],e},{})},t}())}),ymaps.modules.define("src.polylabel.PolylabelCollection",["util.defineClass","src.polylabel.PolylabelBase","src.label.GeoObjectCollection.Label","GeoObjectCollection","Monitor","system.nextTick","data.Manager","event.Manager","Event"],function(t,e,o,n,a,i,l,s,r,c){function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}t(function(t){function o(e,n){p(this,o);var i=u(this,t.call(this,e));return i._map=e,i._labelsCollection=new a,i._labelsState=new WeakMap,i._polygonsCollection=n,i._currentConfiguredVisibility=new WeakMap,i._currentVisibility=new WeakMap,i._isPolygonParentChange=new WeakMap,i._init(),i}return e(o,t),o.prototype.destroy=function(){this._deleteLabelStateListeners(),this._deletePolygonsListeners(),this._deletePolygonCollectionListeners(),this._deleteLabelCollection(),this._map.geoObjects.remove(this._labelsCollection)},o.prototype.getLabelState=function(t){return this._labelsState.get(t)},o.prototype.getConfiguredVisibility=function(t){return this._currentConfiguredVisibility.get(t)},o.prototype.getCurrentVisibility=function(t){return this._currentVisibility.get(t)},o.prototype._init=function(){var t=this;this._map.geoObjects.add(this._labelsCollection),this._firstCalculatePolygons().then(function(){t._initMapListeners(),t._initPolygonCollectionListeners(),t._initPolygonsListeners(),t._initLabelCollectionListeners()})},o.prototype._firstCalculatePolygons=function(){var t=this;return this._clearLabelCollection(),this._polygonsCollection.each(function(e){t._calculateNewPolygon(e).then(function(o){t._analyzeAndSetLabelData(e,o)})}),Promise.resolve()},o.prototype._calculatePolygons=function(){var t=this,e=[];return this._polygonsCollection.each(function(o){if("Polygon"===o.geometry.getType()){var n=t._getFromLabelState(o,"label");n&&e.push(t._analyzeAndSetLabelData(o,n))}}),Promise.all(e)},o.prototype._clearLabelCollection=function(){this._labelsCollection.removeAll(),this._labelsCollection.options.set({pane:"phantom"})},o.prototype._deleteLabelCollection=function(){var t=this;this._polygonsCollection.each(function(e){var o=t._getFromLabelState(e,"label");o&&o.destroy()}),this._clearLabelCollection()},o.prototype._calculatePolygonLabelData=function(t,e){var o=this.getOptions(t),a=this.getZoomRangeOptions(t),i=e?this._getFromLabelState(t,"label"):new n(this._map,t,this._labelsCollection);return i.createLabelData(o,a),Promise.resolve(i)},o.prototype._analyzeAndSetLabelData=function(t,e,o){var n=this;return new Promise(function(a){var i=e.setDataByZoom(n._map.getZoom(),o);n._setCurrentConfiguredVisibility(t,i.currentConfiguredVisibileType),n._setCurrentVisibility(t,i.currentVisibleType),a()})},o.prototype._setCurrentConfiguredVisibility=function(t,e){this._currentConfiguredVisibility.set(t,e)},o.prototype._setCurrentVisibility=function(t,e){this._currentVisibility.set(t,-1!==["dot","label"].indexOf(e)?e:"none")},o.prototype._calculateNewPolygon=function(t){var e=this;return"Polygon"!==t.geometry.getType()?Promise.reject():new Promise(function(o){e._calculatePolygonLabelData(t).then(function(n){e._setInLabelState(t,"label",n),e._initLabelStateListener(t),n.createPlacemarks(),n.addToCollection().then(function(){o(n)})})})},o.prototype._setInLabelState=function(t,e,o){var n=this._labelsState.get(t);n||(n=new s,this._labelsState.set(t,n)),n.set(e,o)},o.prototype._getFromLabelState=function(t,e){var o=this._labelsState.get(t);if(o)return o.get(e)},o.prototype._clearVisibilityInLabelsState=function(t){var e=this;this._polygonsCollection.each(function(o){e._setInLabelState(o,"visible",t)})},o.prototype._initLabelStateListener=function(t){var e=this,o=new i(this._labelsState.get(t));this._setInLabelState(t,"labelMonitor",o),o.add("visible",function(o){e._analyzeAndSetLabelData(t,e._getFromLabelState(t,"label"),o)})},o.prototype._initPolygonsListeners=function(){var t=this;this._polygonsCollection.each(function(e){t._initPolygonListener(e)})},o.prototype._initPolygonListener=function(t){"Polygon"===t.geometry.getType()&&(t.events.add(["optionschange","propertieschange"],this._onPolygonOptionsChangeHandler,this),t.events.add("parentchange",this._onPolygonParentChangeHandler,this))},o.prototype._onPolygonParentChangeHandler=function(t){this._isPolygonParentChange.set(t.get("target"),!0)},o.prototype._onPolygonOptionsChangeHandler=function(t){var e=this;l(function(){var o=t.get("target"),n=e._getFromLabelState(o,"label");!e._isPolygonParentChange.get(o)&&n&&(n.setVisibilityForce("none"),n.setLayoutTemplate(),e._calculatePolygonLabelData(o,!0).then(function(t){e._setInLabelState(o,"label",t),e._analyzeAndSetLabelData(o,t)}))})},o.prototype._initPolygonCollectionListeners=function(){this._polygonsCollection.events.add(["add","remove"],this._polygonCollectionEventHandler,this)},o.prototype._polygonCollectionEventHandler=function(t){var e=this;switch(t.get("type")){case"add":var o=t.get("child");this._calculateNewPolygon(o).then(function(t){e._analyzeAndSetLabelData(o,t)});break;case"remove":var n=t.get("child");this._deleteLabelStateListener(n);var a=this._getFromLabelState(n,"label");a&&a.destroy()}},o.prototype._initLabelCollectionListeners=function(){var t=new r({controllers:[{onBeforeEventFiring:function(t,e,o){if("phantom"===o.get("target").options.get("pane"))return!1;var n=o.get("target").properties.get("polygon");if(n){var a=new c({target:n,type:"label"+e},o);n.events.fire("label"+e,a)}return!1}}]});this._labelsCollection.events.setParent(t)},o.prototype._initMapListeners=function(){var t=this;this.initMapListeners(function(e){"boundschange"===e&&(t._clearVisibilityInLabelsState(),t._calculatePolygons())})},o.prototype._deleteLabelStateListeners=function(){var t=this;this._polygonsCollection.each(function(e){t._deleteLabelStateListener(e)})},o.prototype._deleteLabelStateListener=function(t){var e=this._getFromLabelState(t,"labelMonitor");e&&e.removeAll()},o.prototype._deletePolygonCollectionListeners=function(){this._polygonsCollection.events.remove(["add","remove"],this._polygonCollectionEventHandler,this),this.destroyMapListeners()},o.prototype._deletePolygonsListeners=function(){var t=this;this._polygonsCollection.each(function(e){t._deletePolygonListener(e)})},o.prototype._deletePolygonListener=function(t){t.events.remove(["optionschange","propertieschange"],this._onPolygonOptionsChangeHandler,this),t.events.remove("parentchange",this._onPolygonParentChangeHandler,this)},o}(o))}),ymaps.modules.define("src.polylabel.PolylabelObjectManager",["util.defineClass","src.polylabel.PolylabelBase","data.Manager","Monitor","ObjectManager","src.label.ObjectManager.Label","system.nextTick","event.Manager"],function(t,e,o,n,a,i,l,s,r){function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function p(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}t(function(t){function o(e,n){c(this,o);var a=p(this,t.call(this,e));return a._map=e,a._polygonsObjectManager=n,a._labelsObjectManager=new i,a._labelsState=new WeakMap,a._currentConfiguredVisibility=new WeakMap,a._currentVisibility=new WeakMap,a._init(),a}return e(o,t),o.prototype.destroy=function(){this._deleteLabelsOverlaysListeners(),this._deleteLabelStateListeners(),this._deletePolygonsListeners(),this._deletePolygonsObjectsListeners(),this._deleteLabelsOMListeners()},o.prototype.getLabelState=function(t){return this._labelsState.get(t)},o.prototype.getConfiguredVisibility=function(t){return this._currentConfiguredVisibility.get(t)},o.prototype.getCurrentVisibility=function(t){return this._currentVisibility.get(t)},o.prototype._init=function(){var t=this;this._map.geoObjects.add(this._labelsObjectManager),this._initLabelsOverlaysListeners(),this._initPolygonsObjectsListeners(),this._initPolygonsListeners(),this._initLabelsOMListeners(),this._calculatePolygons().then(function(){return t._initMapListeners()})},o.prototype._calculatePolygons=function(){var t=this;return this._polygonsObjectManager.objects.each(function(e){t._calculateNewPolygon(e)}),Promise.resolve()},o.prototype._calculatePolygonLabelData=function(t,e){var o=this.getOptions(t),n=this.getZoomRangeOptions(t),a=e?this._getFromLabelState(t,"label"):new l(this._map,t,this._labelsObjectManager);return a.createLabelData(o,n),Promise.resolve(a)},o.prototype._analyzeAndSetLabelData=function(t,e,o,n){var a=o.setDataByZoom(this._map.getZoom(),e,n);this._setCurrentConfiguredVisibility(t,a.currentConfiguredVisibileType),this._setCurrentVisibility(t,a.currentVisibleType)},o.prototype._setCurrentConfiguredVisibility=function(t,e){this._currentConfiguredVisibility.set(t,e)},o.prototype._setCurrentVisibility=function(t,e){this._currentVisibility.set(t,-1!==["dot","label"].indexOf(e)?e:"none")},o.prototype._initLabelStateListener=function(t){var e=this,o=new a(this._labelsState.get(t));this._setInLabelState(t,"labelMonitor",o),o.add("visible",function(o){t&&e._analyzeAndSetLabelData(t,["dot","label"],e._getFromLabelState(t,"label"),o)})},o.prototype._initLabelsOverlaysListeners=function(){this._labelsObjectManager.objects.overlays.events.add(["add","remove"],this._labelsOverlaysEventHandler,this)},o.prototype._getLabelType=function(t){return-1!==t.indexOf("label#")?"label":"dot"},o.prototype._labelOverlaysGeometryChangeHandler=function(t){var e=this,o=t.get("target"),n=o._data.id;o.getLayout().then(function(t){var o=e._getLabelType(n),a=e._labelsObjectManager.objects.getById(n);if(a){var i=a.properties.polygon,l=e._getFromLabelState(i,"label");l.setLayout(o,t),e._analyzeAndSetLabelData(i,[o],l)}})},o.prototype._labelsOverlaysEventHandler=function(t){var e=this,o=t.get("objectId"),n=this._getLabelType(o),a=t.get("overlay");switch(t.get("type")){case"add":a.events.add("geometrychange",this._labelOverlaysGeometryChangeHandler,this),s(function(){a&&a.getLayout().then(function(t){if(t){var a=e._labelsObjectManager.objects.getById(o);if(a){var i=a.properties.polygon,l=e._getFromLabelState(i,"label");l.setLayout(n,t),e._analyzeAndSetLabelData(i,[n],l)}}})});break;case"remove":a.events.remove("geometrychange",this._labelOverlaysGeometryChangeHandler,this)}},o.prototype._setInLabelState=function(t,e,o){var a=this._labelsState.get(t);a||(a=new n,this._labelsState.set(t,a)),a.set(e,o)},o.prototype._getFromLabelState=function(t,e){var o=this._labelsState.get(t);if(o)return o.get(e)},o.prototype._clearVisibilityInLabelsState=function(){var t=this;this._polygonsObjectManager.objects.each(function(e){t._setInLabelState(e,"visible",void 0)})},o.prototype._initMapListeners=function(){var t=this;this.initMapListeners(function(e){"boundschange"===e&&t._clearVisibilityInLabelsState()})},o.prototype._initPolygonsObjectsListeners=function(){this._polygonsObjectManager.objects.events.add(["add","remove"],this._polygonCollectionEventHandler,this)},o.prototype._polygonCollectionEventHandler=function(t){switch(t.get("type")){case"add":var e=t.get("child");this._calculateNewPolygon(e);break;case"remove":var o=t.get("child");this._deleteLabelStateListener(o);var n=this._getFromLabelState(o,"label");n&&n.destroy()}},o.prototype._calculateNewPolygon=function(t){var e=this;"Polygon"===t.geometry.type&&this._calculatePolygonLabelData(t).then(function(o){e._setInLabelState(t,"label",o),e._initLabelStateListener(t),o.createPlacemarks(),o.addToObjectManager()})},o.prototype._initPolygonsListeners=function(){this._polygonsObjectManager.objects.events.add(["optionschange","objectoptionschange"],this._onPolygonOptionsChangeHandler,this)},o.prototype._onPolygonOptionsChangeHandler=function(t){var e=this,o=this._polygonsObjectManager.objects.getById(t.get("objectId"));o&&this._calculatePolygonLabelData(o,!0).then(function(t){t.setVisibilityForce("none"),e._setInLabelState(o,"label",t),t.setLayoutTemplate(),t.setNewOptions(o.options),e._analyzeAndSetLabelData(o,["dot","label"],e._getFromLabelState(o,"label"))})},o.prototype._initLabelsOMListeners=function(){var t=this,e=new r({controllers:[{onBeforeEventFiring:function(e,o,n){var a=n.get("objectId");if(!a)return!1;var i=a.split("#")[1];i=isNaN(Number(i))?i:Number(i);var l=t._polygonsObjectManager.objects.getById(i),s=t._labelsObjectManager.objects.getById(a);return!(s&&"phantom"===s.options.pane||!l)&&(t._polygonsObjectManager.events.fire("label"+o,{objectId:i,type:"label"+o}),!1)}}]});this._labelsObjectManager.events.setParent(e)},o.prototype._deleteLabelStateListeners=function(){var t=this;this._polygonsObjectManager.objects.each(function(e){"Polygon"===e.geometry.type&&t._deleteLabelStateListener(e)})},o.prototype._deleteLabelStateListener=function(t){var e=this._getFromLabelState(t,"labelMonitor");e&&e.removeAll()},o.prototype._deleteLabelsOverlaysListeners=function(){this._labelsObjectManager.objects.overlays.events.remove(["add","remove"],this._labelsOverlaysEventHandler,this)},o.prototype._deletePolygonsListeners=function(){this._polygonsObjectManager.objects.events.remove(["optionschange","objectoptionschange"],this._onPolygonOptionsChangeHandler,this)},o.prototype._deletePolygonsObjectsListeners=function(){this._polygonsObjectManager.objects.events.remove(["add","remove"],this._polygonCollectionEventHandler,this),this.destroyMapListeners()},o.prototype._deleteLabelsOMListeners=function(){var t=this;this._polygonsObjectManager.objects.each(function(e){var o=t._getFromLabelState(e,"label");"Polygon"===e.geometry.type&&o&&o.destroy()}),this._clearLabels()},o.prototype._clearLabels=function(){this._labelsObjectManager.removeAll()},o}(o))}),ymaps.modules.define("util.createPolylabel",["src.polylabel.PolylabelCollection","src.polylabel.PolylabelObjectManager","ObjectManager"],function(t,e,o,n){t(function(t,a){return a instanceof n?new o(t,a):new e(t,a)})}),ymaps.modules.define("src.util.checkPointPosition",[],function(t){function e(t,e,i){var l=o(i,e),s=o(t,e),r=l[0]*s[1]-s[0]*l[1];return r>0?"LEFT":r<0?"RIGHT":l[0]*s[0]<0||l[1]*s[1]<0?"BEHIND":n(l)<n(s)?"BEYOND":a(e,t)?"ORIGIN":a(i,t)?"DESTINATION":"BETWEEN"}function o(t,e){return[t[0]-e[0],t[1]-e[1]]}function n(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}function a(t,e){return t[0]===e[0]&&t[1]===e[1]}function i(t,o){var n=o[0],a=o[1];switch(e(t,n,a)){case"LEFT":return n[1]<t[1]&&t[1]<=a[1]?"CROSSING":"INESSENTIAL";case"RIGHT":return a[1]<t[1]&&t[1]<=n[1]?"CROSSING":"INESSENTIAL";case"BETWEEN":case"ORIGIN":case"DESTINATION":return"TOUCHING";default:return"INESSENTIAL"}}t(function(t,e){for(var o=0,n=0;n<e.length-1;n++)switch(i(t,[e[n],e[n+1]])){case"TOUCHING":return"BOUNDARY";case"CROSSING":o=1-o}return o?"INSIDE":"OUTSIDE"})}),ymaps.modules.define("src.util.clickHelper",[],function(t){function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function t(o){e(this,t),this._map=o})}),ymaps.modules.define("src.util.ClickHelper",[],function(t){function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(o){e(this,t),this._map=o,this._polygonStates=new Map,this._init()}return t.prototype._init=function(){this._map.events.add(["dblclick","click"],this._mapEventsHandler,this)},t.prototype.getClick=function(t,e){var o=this;setTimeout(function(){e(o._dblClick?"dblclick":o._click?"click":"none"),o._click=!1,o._dblClick=!1},250)},t.prototype.finishClick=function(t){var e=this._polygonStates.get(t);e&&clearTimeout(e)},t.prototype._mapEventsHandler=function(t){var e=t.get("type");console.log(e),"click"===e?this._click=!0:"dblclick"===e&&(this._dblClick=!0)},t.prototype.destroy=function(){this._map.events.remove(["dblclick","click"],this._mapEventsHandler,this)},t}())}),ymaps.modules.define("src.util.getPolesOfInaccessibility",["util.calculateArea","GeoObject"],function(t,e,o){function n(t,e){if(!(this instanceof n))return new n(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||a,this.length>0)for(var o=this.length>>1;o>=0;o--)this._down(o)}function a(t,e){return t<e?-1:t>e?1:0}function i(t,e,o){e=e||1;for(var n,a,i,r,p=0;p<t[0].length;p++){var y=t[0][p];(!p||y[0]<n)&&(n=y[0]),(!p||y[1]<a)&&(a=y[1]),(!p||y[0]>i)&&(i=y[0]),(!p||y[1]>r)&&(r=y[1])}var h=i-n,b=r-a,f=Math.min(h,b),d=f/2,g=new u(null,l);if(0===f)return[n,a];for(var _=n;_<i;_+=f)for(var m=a;m<r;m+=f)g.push(new s(_+d,m+d,d,t));var v=c(t),L=new s(n+h/2,a+b/2,0,t);L.d>v.d&&(v=L);for(var C=g.length;g.length;){var O=g.pop();O.d>v.d&&(v=O,o&&console.error("found best %d after %d probes",Math.round(1e4*O.d)/1e4,C)),O.max-v.d<=e||(d=O.h/2,g.push(new s(O.x-d,O.y-d,d,t)),g.push(new s(O.x+d,O.y-d,d,t)),g.push(new s(O.x-d,O.y+d,d,t)),g.push(new s(O.x+d,O.y+d,d,t)),C+=4)}return o&&(console.error("num probes: "+C),console.error("best distance: "+v.d)),[v.x,v.y]}function l(t,e){return e.max-t.max}function s(t,e,o,n){this.x=t,this.y=e,this.h=o,this.d=r(t,e,n),this.max=this.d+this.h*Math.SQRT2}function r(t,e,o){for(var n=!1,a=1/0,i=0;i<o.length;i++)for(var l=o[i],s=0,r=l.length,c=r-1;s<r;c=s++){var u=l[s],y=l[c];u[1]>e!=y[1]>e&&t<(y[0]-u[0])*(e-u[1])/(y[1]-u[1])+u[0]&&(n=!n),a=Math.min(a,p(t,e,u,y))}return(n?1:-1)*Math.sqrt(a)}function c(t){for(var e=0,o=0,n=0,a=t[0],i=0,l=a.length,r=l-1;i<l;r=i++){var c=a[i],p=a[r],u=c[0]*p[1]-p[0]*c[1];o+=(c[0]+p[0])*u,n+=(c[1]+p[1])*u,e+=3*u}return 0===e?new s(a[0][0],a[0][1],0,t):new s(o/e,n/e,0,t)}function p(t,e,o,n){var a=o[0],i=o[1],l=n[0]-a,s=n[1]-i;if(0!==l||0!==s){var r=((t-a)*l+(e-i)*s)/(l*l+s*s);r>1?(a=n[0],i=n[1]):r>0&&(a+=l*r,i+=s*r)}return l=t-a,s=e-i,l*l+s*s}t(function(t,n,a){if(void 0===e)throw new Error("Didn't find calculateArea module");var l=Number.MIN_VALUE,s=0,r=void 0;if(t.length>1){for(var c=0;c<t.length;c++){var p=new o({geometry:{type:"Polygon",coordinates:[t[c]]}}),u=Math.round(e(p));l<u&&(l=u,s=c)}r=[t[s]]}else r=t;return{center:i(r,n,a),index:s}}),n.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return--this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,o=this.compare,n=e[t];t>0;){var a=t-1>>1,i=e[a];if(o(n,i)>=0)break;e[t]=i,t=a}e[t]=n},_down:function(t){for(var e=this.data,o=this.compare,n=this.length>>1,a=e[t];t<n;){var i=1+(t<<1),l=i+1,s=e[i];if(l<this.length&&o(e[l],s)<0&&(i=l,s=e[l]),o(s,a)>=0)break;e[t]=s,t=i}e[t]=a}};var u=n}),ymaps.modules.define("src.util.zoom.getFirstZoomInside",["src.util.checkPointPosition","src.config"],function(t,e,o){function n(t,e,o,n,a,i){var l=t.options.get("projection").toGlobalPixels(e,o),s=n.width,r=n.height;l[0]+=a[0],l[1]+=a[1];var c=[],p=[];return c.push([l[0]-s/2,l[1]-r/2],[l[0]-s/2,l[1]+r/2],[l[0]+s/2,l[1]-r/2],[l[0]+s/2,l[1]+r/2]),p.push([c[0][0]+i>l[0]?l[0]:c[0][0]+i,c[0][1]+i>l[1]?l[1]:c[0][1]+i],[c[1][0]+i>l[0]?l[0]:c[1][0]+i,c[1][1]-i<l[1]?l[1]:c[1][1]-i],[c[2][0]-i<l[0]?l[0]:c[2][0]-i,c[2][1]+i>l[1]?l[1]:c[2][1]+i],[c[3][0]-i<l[0]?l[0]:c[3][0]-i,c[3][1]-i<l[1]?l[1]:c[3][1]-i]),{normal:c,withInaccuracy:p}}function a(t,o,n,a){for(var i=0;i<n.length;i++){var l=t.options.get("projection").fromGlobalPixels(n[i],a);if("INSIDE"!==e(l,o))return!1}return!0}t(function(t,e,i,l,s,r){for(var c=o.MIN_ZOOM,p=o.MAX_ZOOM,u=void 0;c<p;){u=Math.floor((c+p)/2);var y=isNaN(Number(r))?0:Number(r),h=n(t,e,u,l,s||[0,0],y);a(t,i,h.normal,u)||0!==y&&a(t,i,h.withInaccuracy,u)?p=u:c=u+1}return c})}),ymaps.modules.define("src.util.zoom.parseZoomData",["util.array","util.objectKeys","src.config"],function(t,e,o,n){function a(t,e,o){t[e]=o}function i(t,e,o){if(isNaN(Number(e))){var n=e.split("_").map(Number);if(!isNaN(n[0])&&!isNaN(n[1]))for(var a=n[0]<r?r:n[0],i=n[1]>c?c:n[1];a<=i;)t[a]=o,a++}else t[Number(e)]=o}function l(t){for(var e={},o=r;o<=c;o++)e[o]=t;return e}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=n.MIN_ZOOM,c=n.MAX_ZOOM;t(function(t){var n=["number","string","boolean","object"];return t&&!e.isArray(t)&&"object"===(void 0===t?"undefined":s(t))?o(t).reduce(function(e,o){return"string"==typeof o?i(e,o,t[o]):"number"==typeof o&&a(e,o,t[o]),e},l()):n.includes(void 0===t?"undefined":s(t))?l(t):void 0})}),ymaps.modules.define("src.util.zoom.setZoomVisibility",["src.util.zoom.getFirstZoomInside","src.label.util.getLayoutSize"],function(t,e,o){function n(t,e,o){var n=["none","dot","label"],a=t;return o&&(a=n.indexOf(e)>n.indexOf(t)?e:t),a}function a(t,a,i,l,s,r,c,p,u){var y=o(s);if(y)return{visible:n(l,t,i>=e(a,r,c,y,p,u)),size:y}}t(function(t,e,o,n,i,l,s,r,c){return a(t,e,o,n,i,l,s,r,c)})});