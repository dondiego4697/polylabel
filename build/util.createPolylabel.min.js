ymaps.modules.define("src.config",[],function(e){e({MIN_ZOOM:0,MAX_ZOOM:19,options:["labelLayout","labelDotLayout","labelDotVisible"],zoomRangeOptions:["labelClassName","labelForceVisible","labelTextColor","labelTextSize","labelCenterCoords","labelOffset","labelPermissibleInaccuracyOfVisibility"],properties:[]})}),ymaps.modules.define("src.label.GeoObjectCollection.Label",["util.extend","util.objectKeys","Placemark","src.label.util.LabelPlacemarkOverlay","src.label.LabelData","src.label.util.layoutTemplates.getBaseLayoutTemplates","src.label.util.layoutTemplates.createLayoutTemplates"],function(e,t,o,a,n,i,l,s){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(function(){function e(t,o,a){r(this,e),this._map=t,this._polygon=o,this._parentCollection=a,this._placemark={label:null,dot:null},this._layout={label:null,dot:null},this._init()}return e.prototype.setLabelData=function(e,t){return this._data=new i(this._polygon,e,t,this._map,this),this._data},e.prototype.getLabelData=function(){return this._data},e.prototype.getPlacemark=function(e){return this._placemark[e]},e.prototype.getLayout=function(e){return this._layout[e]},e.prototype.removeFromCollection=function(){var e=this;this._parentCollection&&(["label","dot"].forEach(function(t){-1!==e._parentCollection.indexOf(e._placemark[t])&&e._parentCollection.remove(e._placemark[t])}),this._polygon=null,this._parentCollection=null,this._placemark=null,this._layout=null,this._data=null)},e.prototype.addToCollection=function(){var e=this;if(!this._parentCollection)return Promise.reject();var t=["label","dot"].map(function(t){return e._placemark[t].getParent()||e._parentCollection.add(e._placemark[t]),e.getLabelLayout(t).then(function(o){e._layout[t]=o})});return Promise.all(t)},e.prototype.getLabelLayout=function(e){return this._placemark[e].getOverlay().then(function(e){return e.getLayout()})},e.prototype._init=function(){var o=this,a=l(),n=s(this._polygon.options.get("labelLayout"),this._polygon.options.get("labelDotLayout"));["label","dot"].forEach(function(i){o._placemark[i]=e._createPlacemark({properties:t({},{labelPolygon:o._polygon},o._polygon.properties.getAll()),options:t({},o._polygon.options.getAll(),n[i])},a[i])})},e._createPlacemark=function(e,o){var i=t({},{iconLayout:o,pointOverlay:n,iconLabelPosition:"absolute"},e.options);return new a([0,0],e.properties,i)},e.prototype.setDataByZoom=function(e,t){var o=this._data.getAll();this.setStyles(o.zoomInfo[e].style),this._data.setZoomData(e);var a=o.zoomInfo,n=o.autoCenter,i=o.dotVisible,l=o.dotSize;a=a[e],this.setCoordinates(a.center||n);var s="auto"===(t=t||a.visibleForce)?a.visible:t;return"dot"!==s||i||(s="none"),this.setVisibility(s),-1!==["dot","label"].indexOf(s)&&this.setCenterAndIconShape(s,"dot"===s?l:a.labelSize,a.labelOffset),{visible:a.visible,visibleForce:a.visibleForce,visibleType:s}},e.prototype.setLayoutTemplate=function(){var e=this,t=s(this._polygon.options.get("labelLayout"),this._polygon.options.get("labelDotLayout"));o(t).forEach(function(o){e._placemark[o].options.set(t[o])})},e.prototype.setCoordinates=function(e){var t=this;e.toString()!==this._placemark.label.geometry.getCoordinates().toString()&&["dot","label"].forEach(function(o){t._placemark[o].geometry.setCoordinates(e)})},e.prototype.setVisibility=function(e){var t=this;o(this._placemark).forEach(function(o){var a=o===e?"places":"phantom";t._placemark[o].options.set({pane:a})})},e.prototype.setStyles=function(e){this._placemark.label.options.set({iconLabelClassName:e.className,iconLabelTextSize:e.textSize,iconLabelTextColor:e.textColor})},e.prototype.setCenterAndIconShape=function(e,t,o){var a=t.height/2,n=t.width/2;this._placemark[e].options.set({iconShape:{type:"Rectangle",coordinates:[[-n+o[0],-a+o[1]],[n+o[0],a+o[1]]]},iconLabelLeft:-n+o[0],iconLabelTop:-a+o[1]})},e.prototype.destroy=function(){this.removeFromCollection()},e}())}),ymaps.modules.define("src.label.LabelData",["util.objectKeys","src.config","src.util.zoom.parseZoomData","src.util.getPolesOfInaccessibility","GeoObject","src.util.zoom.setOneZoomVisibility"],function(e,t,o,a,n,i,l){function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=o.MIN_ZOOM,c=o.MAX_ZOOM;e(function(){function e(t,o,a,n,i){s(this,e),this._map=n,this._labelInst=i,this._polygon=t,this._data={zoomInfo:{},autoCenter:[0,0],polygonIndex:0,dotSize:{height:0,width:0},dotFirstZoom:void 0,dotVisible:"boolean"!=typeof o.labelDotVisible||o.labelDotVisible},this._parsedOptions=this._parseOptions(a),this._init()}return e.prototype.setData=function(e,t){this._data[e]=t},e.prototype.getData=function(e){return this._data[e]},e.prototype.setZoomInfo=function(e,t,o){this._data.zoomInfo[e][t]=o},e.prototype.getZoomInfo=function(e){return e||"number"==typeof e&&0===e?this._data.zoomInfo[e]:this._data.zoomInfo},e.prototype.getAll=function(){return this._data},e.prototype.getPolygonCoords=function(){var e=this._polygon.geometry;return this._polygon instanceof i?e.getCoordinates()[this._data.polygonIndex]:e.coordinates[this._data.polygonIndex]},e.prototype.setZoomData=function(e){2!==this._data.zoomInfo[e].isCalculated&&(l(this._map,e,this._labelInst,"dot"),l(this._map,e,this._labelInst,"label"),this._data.zoomInfo[e].isCalculated=2)},e.prototype.setZoomDataForType=function(e,t){2!==this._data.zoomInfo[t].isCalculated&&l(this._map,t,this._labelInst,e)&&this._data.zoomInfo[t].isCalculated++},e.prototype._init=function(){var e=this._polygon.geometry,t=this._polygon instanceof i?e.getCoordinates():e.coordinates,o=n(t,1);this._data.autoCenter=o.center,this._data.polygonIndex=o.index;for(var a=r;a<=c;a++)this._data.zoomInfo[a]=this._fillZoom(a)},e.prototype._fillZoom=function(e){var t=this._createDefaultZoomInfo();return this._setData(t,"visibleForce",this._parsedOptions.labelForceVisible,e),this._setData(t,"center",this._parsedOptions.labelCenterCoords,e),this._setData(t,"labelOffset",this._parsedOptions.labelOffset,e),this._setData(t,"permissibleInaccuracyOfVisibility",this._parsedOptions.labelPermissibleInaccuracyOfVisibility,e),this._setData(t,"style.className",this._parsedOptions.labelClassName,e),this._setData(t,"style.textSize",this._parsedOptions.labelTextSize,e),this._setData(t,"style.textColor",this._parsedOptions.labelTextColor,e),t},e.prototype._setData=function(e,t,o,a){function n(e,t){e.length>1?n(e.slice(1),t[e[0]]):t[e[0]]=o[a]}var i=t.split(".");o&&o[a]&&n(i,e)},e.prototype._parseOptions=function(e){var o={};return t(e).forEach(function(t){o[t]=a(e[t])}),o},e.prototype._createDefaultZoomInfo=function(){return{isCalculated:0,visible:"none",visibleForce:"auto",center:void 0,style:{className:void 0,textSize:void 0,textColor:void 0},labelSize:{height:0,width:0},labelOffset:[0,0],permissibleInaccuracyOfVisibility:0}},e}())}),ymaps.modules.define("src.label.ObjectManager.Label",["util.extend","util.objectKeys","src.label.util.LabelPlacemarkOverlay","src.label.LabelData","src.label.util.layoutTemplates.getBaseLayoutTemplates","src.label.util.layoutTemplates.createLayoutTemplates"],function(e,t,o,a,n,i,l){function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(function(){function e(t,o,a){s(this,e),this._map=t,this._polygon=o,this._objectManager=a,this._placemark={label:null,dot:null},this._layout={label:null,dot:null},this._init()}return e.prototype.destroy=function(){this.removeFromCollection()},e.prototype.getPlacemark=function(e){return this._placemark[e]},e.prototype.getLayout=function(e){return this._layout[e]},e.prototype.addToObjectManager=function(){var e=this;["label","dot"].forEach(function(t){e._objectManager.add(e._placemark[t])})},e.prototype.removeFromCollection=function(){var e=this;["label","dot"].forEach(function(t){e._objectManager.remove(e._placemark[t])}),this._polygon=null,this._objectManager=null,this._placemark=null,this._layout=null,this._data=null},e.prototype._init=function(){var o=this,a=i(),n=l(this._polygon.options.labelLayout,this._polygon.options.labelDotLayout);["label","dot"].forEach(function(i){o._placemark[i]=e._createPlacemark(i+"#"+o._polygon.id,{properties:t({},{labelPolygon:o._polygon},o._polygon.properties),options:t({},o._polygon.options,n[i])},a[i])})},e._createPlacemark=function(e,o,n){return{type:"Feature",id:e,options:t({},{iconLayout:n,iconLabelPosition:"absolute",overlay:a,pane:"phantom"},o.options),properties:o.properties,geometry:{type:"Point",coordinates:[0,0]}}},e.prototype._updateOptions=function(e,t){this._objectManager.objects.setObjectOptions(e,t)},e.prototype.setLabelData=function(e,t){return this._data=new n(this._polygon,e,t,this._map,this),this._data},e.prototype.getLabelData=function(){return this._data},e.prototype.setLayout=function(e,t){this._layout[e]=t},e.prototype.setLayoutTemplate=function(){var e=this,t=l(this._polygon.options.labelLayout,this._polygon.options.labelDotLayout);o(t).forEach(function(o){e._updateOptions(e._placemark[o].id,t[o])})},e.prototype.setNewOptions=function(e){var o=this;["dot","label"].forEach(function(a){o._updateOptions(o._placemark[a].id,t({},o._placemark[a].options,e))})},e.prototype.setDataByZoom=function(e,t,o){var a=this,n=this._data.getAll(),i={};return t.forEach(function(t){"label"===t&&a.setStyles(n.zoomInfo[e].style),a._data.setZoomDataForType(t,e);var l=a._data.getAll(),s=l.zoomInfo,r=l.autoCenter,c=l.dotVisible,p=l.dotSize;s=s[e],a.setCoordinates(s.center||r);var u="auto"===(o=o||s.visibleForce)?s.visible:o;"dot"!==u||c||(u="none"),i={visible:s.visible,visibleForce:s.visibleForce,visibleType:u,dotSize:p,zoomInfo:s}}),this.setVisibility(i.visibleType),-1!==["dot","label"].indexOf(i.visibleType)&&this.setCenterAndIconShape(i.visibleType,"dot"===i.visibleType?i.dotSize:i.zoomInfo.labelSize,i.zoomInfo.labelOffset),i},e.prototype.setCenterAndIconShape=function(e,t,o){var a=t.height/2,n=t.width/2;this._updateOptions(this._placemark[e].id,{iconShape:{type:"Rectangle",coordinates:[[-n+o[0],-a+o[1]],[n+o[0],a+o[1]]]},iconLabelLeft:-n+o[0],iconLabelTop:-a+o[1]})},e.prototype.setCoordinates=function(e){var t=this;return e.toString()!==this._placemark.label.geometry.coordinates.toString()&&(["dot","label"].forEach(function(o){t._objectManager.remove(t._placemark[o]),t._generateNewPlacemark(o),t._placemark[o].geometry.coordinates=e,t._objectManager.add(t._placemark[o])}),!0)},e.prototype.setStyles=function(e){this._updateOptions(this._placemark.label.id,{iconLabelClassName:e.className,iconLabelTextSize:e.textSize,iconLabelTextColor:e.textColor})},e.prototype.setVisibility=function(e){var t=this;o(this._placemark).forEach(function(o){var a=o===e?"places":"phantom";t._updateOptions(t._placemark[o].id,{pane:a})})},e.prototype._generateNewPlacemark=function(e){this._placemark[e]=t({},this._placemark[e]);var o=this._placemark[e].id;this._placemark[e].id="_"===o[0]?o.slice(1):"_"+o},e}())}),ymaps.modules.define("src.label.ObjectManager.Label1",["util.extend","util.objectKeys","Placemark","src.label.util.LabelPlacemarkOverlay","src.label.util.createLabelLayoutTemplate","src.label.util.createDotLayoutTemplate","src.label.util.getLabelLayout","src.label.LabelData"],function(e,t,o,a,n,i,l,s,r){function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(function(){function e(t,o,a){c(this,e),this._polygon=t,this._objectManager=o,this._placemark={label:null,dot:null},this._layout={label:null,dot:null},this._layoutTemplateCache=a,this._init()}return e.prototype.destroy=function(){this.removeFromCollection()},e.prototype.getPlacemark=function(e){return this._placemark[e]},e.prototype.getLayout=function(e){return this._layout[e]},e.prototype.addToObjectManager=function(){var e=this;["label","dot"].forEach(function(t){e._objectManager.add(e._placemark[t])})},e.prototype.removeFromCollection=function(){var e=this;["label","dot"].forEach(function(t){e._objectManager.remove(e._placemark[t])}),this._polygon=null,this._objectManager=null,this._placemark=null},e.prototype._init=function(){var o=this,a=this._getLayoutTemplate(this._polygon.options,this._layoutTemplateCache),n={label:a.labelLayout,dot:a.labelDotLayout};["label","dot"].forEach(function(a){o._placemark[a]=e._createPlacemark(a+"#"+o._polygon.id,{properties:t({},{_labelPolygon:o._polygon},o._polygon.properties),options:o._polygon.options},n[a])})},e._createPlacemark=function(e,o,a){return{type:"Feature",id:e,options:t({},{iconLayout:a,iconLabelPosition:"absolute",pointOverlay:n,pane:"phantom"},o.options),properties:o.properties,geometry:{type:"Point",coordinates:[0,0]}}},e.prototype._updateOptions=function(e,t){this._objectManager.objects.setObjectOptions(e,t)},e.prototype.setLabelData=function(e,t){return this._data=new r(this._polygon,e,t),this._data},e.prototype.getLabelData=function(){return this._data},e.prototype.setLayout=function(e,t){this._layout[e]=t},e.prototype.setDataByZoom=function(e,t){var o=this._data.getAll(),a=o.zoomInfo,n=o.autoCenter,i=o.dotVisible;a=a[e],this.setCoordinates(a.center||n);var l="auto"===(t=t||a.visibleForce)?a.visible:t;return"dot"!==l||i||(l="none"),this.setVisibility(l),-1!==["dot","label"].indexOf(l)&&this.setCenterAndIconShape(l,"dot"===l?this._data.getData("dotSize"):a.labelSize,a.labelOffset),this.setStyles(a.style),{visible:a.visible,visibleForce:a.visibleForce,visibleType:l}},e.prototype.setCenterAndIconShape=function(e,t,o){var a=t.height/2,n=t.width/2;this._updateOptions(this._placemark[e].id,{iconShape:{type:"Rectangle",coordinates:[[-n+o[1],-a+o[0]],[n+o[1],a+o[0]]]},iconLabelTop:-a+o[0],iconLabelLeft:-n+o[1]})},e.prototype.setCoordinates=function(e){var t=this;e.toString()!==this._placemark.label.geometry.coordinates.toString()&&["dot","label"].forEach(function(o){t._objectManager.remove(t._placemark[o]),t._generateNewPlacemark(o),t._placemark[o].geometry.coordinates=e,t._objectManager.add(t._placemark[o])})},e.prototype.setStyles=function(e){this._updateOptions(this._placemark.label.id,{iconLabelClassName:e.className,iconLabelTextSize:e.textSize,iconLabelTextColor:e.textColor})},e.prototype.setVisibility=function(e){var t=this;o(this._placemark).forEach(function(o){var a=o===e?"places":"phantom";t._updateOptions(t._placemark[o].id,{pane:a})})},e.prototype._generateNewPlacemark=function(e){this._placemark[e]=t({},this._placemark[e]);var o=this._placemark[e].id;this._placemark[e].id="_"===o[0]?o.slice(1):"_"+o},e.prototype._getLayoutTemplate=function(e,t){return["labelLayout","labelDotLayout"].reduce(function(o,a){var n=e[a],s=n||"default"+a;if(t[s])o[a]=t[s];else{var r={labelLayout:i,labelDotLayout:l}[a](n);o[a]=r,t[s]=r}return o},{})},e}())}),ymaps.modules.define("src.label.util.createDotLayoutTemplate",["templateLayoutFactory"],function(e,t){e(function(e){return void 0===e&&(e="<div {% style %}background-color: red;\n    width: 10px; height: 10px; border-radius: 50px;{% endstyle %}></div>"),t.createClass("\n    <div {% style %}position: {{options.labelPosition}};\n        top: {{options.labelTop}}px; left: {{options.labelLeft}}px; {% endstyle %}>\n        "+e+"\n    </div>")})}),ymaps.modules.define("src.label.util.createLabelLayoutTemplate",["templateLayoutFactory"],function(e,t){e(function(e){return t.createClass('\n    <div {% style %}position: {{options.labelPosition}};\n        top: {{options.labelTop}}px; left: {{options.labelLeft}}px; {% endstyle %}>\n        <div class="{{options.labelClassName}}"\n            {% style %}text-align: center; font-size: {{options.labelTextSize}}px;\n            color: {{options.labelTextColor}}; {% endstyle %}>\n            '+e+"\n        </div>\n    </div>")})}),ymaps.modules.define("src.label.util.getLabelLayout",[],function(e){e(function(e){return e.getOverlay().then(function(e){return e.getLayout()})})}),ymaps.modules.define("src.label.util.getLayoutSize",[],function(e){e(function(e){var t=e&&e.getElement();if(t){for(var o=0,a=0;0===o&&0===a;){var n=(t=t.children[0]).getBoundingClientRect();o=n.width,a=n.height}return{width:o,height:a}}})}),ymaps.modules.define("src.label.util.getLayoutTemplate",["src.label.util.layoutTemplates.labelLayoutTemplate","src.label.util.layoutTemplates.dotLayoutTemplate"],function(e,t,o){e(function(){return{label:t,dot:o}})}),ymaps.modules.define("src.label.util.LabelPlacemarkOverlay",["util.defineClass","overlay.Placemark","GeoObject"],function(e,t,o,a){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}e(function(e){function o(t,a,l){return n(this,o),i(this,e.call(this,t,a,l))}return t(o,e),o.prototype.getData=function(){var e=this._data.geoObject instanceof a?this._data.geoObject.properties.get("labelPolygon"):this._data.properties.labelPolygon;return{geoObject:e,properties:e.properties,state:e.state}},o}(o))}),ymaps.modules.define("src.label.util.layoutTemplates.createLayoutTemplates",["templateLayoutFactory"],function(e,t){e(function(e,o){return{label:{iconLabelTemplateLayout:t.createClass(e)},dot:{iconLabelDotTemplateLayout:t.createClass(o||"<div {% style %}background-color: red;\nwidth: 10px; height: 10px; border-radius: 50px;{% endstyle %}></div>")}}})}),ymaps.modules.define("src.label.util.layoutTemplates.dotLayoutTemplate",["templateLayoutFactory"],function(e,t){e(t.createClass("\n    <div {% style %}position: {{options.labelPosition}};\n        top: {{options.labelTop}}px; left: {{options.labelLeft}}px; {% endstyle %}>\n            {% include options.labelDotTemplateLayout %}\n        </div>"))}),ymaps.modules.define("src.label.util.layoutTemplates.getBaseLayoutTemplates",["src.label.util.layoutTemplates.labelLayoutTemplate","src.label.util.layoutTemplates.dotLayoutTemplate"],function(e,t,o){e(function(){return{label:t,dot:o}})}),ymaps.modules.define("src.label.util.layoutTemplates.getLayoutTemplate",["src.label.util.layoutTemplates.labelLayoutTemplate","src.label.util.layoutTemplates.dotLayoutTemplate"],function(e,t,o){e(function(){return{label:t,dot:o}})}),ymaps.modules.define("src.label.util.layoutTemplates.getTemplateLayouts",[],function(e){e(function(){return{label:{iconLabelTemplateLayout:ymaps.templateLayoutFactory.createClass(this._polygon.options.get("labelLayout"))},dot:{iconLabelDotTemplateLayout:ymaps.templateLayoutFactory.createClass(this._polygon.options.get("labelDotLayout","<div {% style %}background-color: red;\n            width: 10px; height: 10px; border-radius: 50px;{% endstyle %}></div>"))}}})}),ymaps.modules.define("src.label.util.layoutTemplates.labelLayoutTemplate",["templateLayoutFactory"],function(e,t){e(t.createClass('\n    <div {% style %}position: {{options.labelPosition}};\n        top: {{options.labelTop}}px; left: {{options.labelLeft}}px; {% endstyle %}>\n        <div class="{{options.labelClassName}}"\n            {% style %}text-align: center; font-size: {{options.labelTextSize}}px;\n            color: {{options.labelTextColor}}; {% endstyle %}>\n                {% include options.labelTemplateLayout %}\n            </div>\n        </div>'))}),ymaps.modules.define("src.polylabel.PolylabelBase",["src.config","GeoObject"],function(e,t,o){function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(function(){function e(t){a(this,e),this._map=t}return e.prototype.initMapListeners=function(e){this._mapBoundsChangeCallback=e,this._map.events.add("boundschange",this._mapBoundsChangeHandler,this)},e.prototype.destroyMapListeners=function(){this._map.events.remove("boundschange",this._mapBoundsChangeHandler,this)},e.prototype._mapBoundsChangeHandler=function(e){e.get("newZoom")!==e.get("oldZoom")&&this._mapBoundsChangeCallback(e.get("newZoom"))},e.prototype.getOptions=function(e){return t.options.reduce(function(t,a){return t[a]=e instanceof o?e.options.get(a):e.options[a],t},{})},e.prototype.getZoomRangeOptions=function(e){return t.zoomRangeOptions.reduce(function(t,a){return t[a]=e instanceof o?e.options.get(a):e.options[a],t},{})},e.prototype.getProperties=function(e){return t.properties.reduce(function(t,a){return t[a]=e instanceof o?e.properties.get(a):e.properties[a],t},{})},e}())}),ymaps.modules.define("src.polylabel.PolylabelCollection",["util.defineClass","src.polylabel.PolylabelBase","src.label.GeoObjectCollection.Label","GeoObjectCollection","Monitor","system.nextTick","data.Manager","event.Manager","Event"],function(e,t,o,a,n,i,l,s,r,c){function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}e(function(e){function o(t,a,i){p(this,o);var l=u(this,e.call(this,t));return l._callbackResult=i,l._map=t,l._labelsCollection=new n,l._labelsState=new WeakMap,l._polygonsCollection=a,l._currentConfiguredVisibility=new WeakMap,l._currentVisibility=new WeakMap,l._isPolygonParentChange=new WeakMap,l._initData(),l}return t(o,e),o.prototype.destroy=function(){this._deleteLabelStateListeners(),this._deletePolygonsListeners(),this._deletePolygonCollectionListeners(),this._deleteLabelCollection(),this._map.geoObjects.remove(this._labelsCollection)},o.prototype.getLabelState=function(e){return this._labelsState.get(e)},o.prototype.getConfiguredVisibility=function(e){return this._currentConfiguredVisibility.get(e)},o.prototype.getCurrentVisibility=function(e){return this._currentVisibility.get(e)},o.prototype._initData=function(){var e=this;this._map.geoObjects.add(this._labelsCollection),this._firstCalculatePolygonsCollection().then(function(){e._initMapListeners(),e._initPolygonCollectionListeners(),e._initPolygonsListeners(),e._initLabelCollectionListeners()})},o.prototype._firstCalculatePolygonsCollection=function(){var e=this;this._clearLabelCollection();var t=[];return this._polygonsCollection.each(function(o){e._setInLabelState(o,"visible",void 0),e._initLabelStateListener(o),e._calculatePolygonLabelData(o).then(function(a){e._setInLabelState(o,"label",a),t.push(e._analyzeAndSetLabelData(o,e._getFromLabelState(o,"label")))})}),Promise.all(t)},o.prototype._calculatePolygonsCollection=function(){var e=this,t=[];return this._polygonsCollection.each(function(o){t.push(e._analyzeAndSetLabelData(o,e._getFromLabelState(o,"label")))}),Promise.all(t)},o.prototype._clearLabelCollection=function(){this._labelsCollection.removeAll(),this._labelsCollection.options.set({pane:"phantom"})},o.prototype._deleteLabelCollection=function(){var e=this;this._polygonsCollection.each(function(t){var o=e._getFromLabelState(t,"label");o&&o.destroy()}),this._clearLabelCollection()},o.prototype._calculatePolygonLabelData=function(e,t){var o=this.getOptions(e),n=this.getZoomRangeOptions(e),i=t?this._getFromLabelState(e,"label"):new a(this._map,e,this._labelsCollection);return i.setLabelData(o,n),i.addToCollection().then(function(){return i})},o.prototype._analyzeAndSetLabelData=function(e,t,o){var a=this;return t?(l(function(){var n=t.setDataByZoom(a._map.getZoom(),o);a._setCurrentConfiguredVisibility(e,n.visible,n.visibleForce),a._setCurrentVisibility(e,n.visibleType)}),Promise.resolve()):Promise.resolve()},o.prototype._setCurrentConfiguredVisibility=function(e,t,o){var a=o&&-1!==["dot","label","none"].indexOf(o)?o:t;this._currentConfiguredVisibility.set(e,a)},o.prototype._setCurrentVisibility=function(e,t){this._currentVisibility.set(e,-1!==["dot","label"].indexOf(t)?t:"none")},o.prototype._recalculateNewPolygon=function(e){var t=this;this._calculatePolygonLabelData(e).then(function(o){t._setInLabelState(e,"label",o),t._analyzeAndSetLabelData(e,t._getFromLabelState(e,"label")),t._initLabelStateListener(e)})},o.prototype._setInLabelState=function(e,t,o){var a=this._labelsState.get(e);a||(a=new s,this._labelsState.set(e,a)),a.set(t,o)},o.prototype._getFromLabelState=function(e,t){var o=this._labelsState.get(e);if(o)return o.get(t)},o.prototype._clearVisibilityInLabelsState=function(e){var t=this;this._polygonsCollection.each(function(o){t._setInLabelState(o,"visible",e)})},o.prototype._initLabelStateListener=function(e){var t=this,o=new i(this._labelsState.get(e));this._setInLabelState(e,"labelMonitor",o),o.add("visible",function(o){t._analyzeAndSetLabelData(e,t._getFromLabelState(e,"label"),o)})},o.prototype._initPolygonsListeners=function(){var e=this;this._polygonsCollection.each(function(t){e._initPolygonListener(t)})},o.prototype._initPolygonListener=function(e){e.events.add(["optionschange","propertieschange"],this._onPolygonOptionsChangeHandler,this),e.events.add("parentchange",this._onPolygonParentChangeHandler,this)},o.prototype._onPolygonParentChangeHandler=function(e){this._isPolygonParentChange.set(e.get("target"),2)},o.prototype._onPolygonOptionsChangeHandler=function(e){var t=this;l(function(){var o=e.get("target"),a=t._getFromLabelState(o,"label"),n=t._isPolygonParentChange.get(o);n>0||!a?t._isPolygonParentChange.set(e.get("target"),n-1):(a.setVisibility("phantom"),a.setLayoutTemplate(),t._calculatePolygonLabelData(o,!0).then(function(e){t._setInLabelState(o,"label",e),t._analyzeAndSetLabelData(o,t._getFromLabelState(o,"label"))}))})},o.prototype._initPolygonCollectionListeners=function(){this._polygonsCollection.events.add(["add","remove"],this._polygonCollectionEventHandler,this)},o.prototype._polygonCollectionEventHandler=function(e){switch(e.get("type")){case"add":this._recalculateNewPolygon(e.get("child"));break;case"remove":this._deleteLabelStateListener(e.get("child"));var t=this._getFromLabelState(e.get("child"),"label");t&&t.destroy()}},o.prototype._initLabelCollectionListeners=function(){var e=new r({controllers:[{onBeforeEventFiring:function(e,t,o){if("phantom"===o.get("target").options.get("pane"))return!1;var a=o.get("target").properties.get("labelPolygon");if(a){var n=new c({target:a,type:"label"+t},o);a.events.fire("label"+t,n)}return!1}}]});this._labelsCollection.events.setParent(e)},o.prototype._initMapListeners=function(){var e=this;this.initMapListeners(function(){e._clearVisibilityInLabelsState(),e._calculatePolygonsCollection()})},o.prototype._deleteLabelStateListeners=function(){var e=this;this._polygonsCollection.each(function(t){e._deleteLabelStateListener(t)})},o.prototype._deleteLabelStateListener=function(e){var t=this._getFromLabelState(e,"labelMonitor");t&&t.removeAll()},o.prototype._deletePolygonCollectionListeners=function(){this._polygonsCollection.events.remove(["add","remove"],this._polygonCollectionEventHandler,this),this.destroyMapListeners()},o.prototype._deletePolygonsListeners=function(){var e=this;this._polygonsCollection.each(function(t){e._deletePolygonListener(t)})},o.prototype._deletePolygonListener=function(e){e.events.remove(["optionschange","propertieschange"],this._onPolygonOptionsChangeHandler,this),e.events.remove("parentchange",this._onPolygonParentChangeHandler,this)},o}(o))}),ymaps.modules.define("src.polylabel.PolylabelObjectManager",["util.defineClass","util.objectKeys","src.polylabel.PolylabelBase","data.Manager","Monitor","ObjectManager","src.label.ObjectManager.Label","system.nextTick","event.Manager"],function(e,t,o,a,n,i,l,s,r,c){function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}e(function(e){function a(t,o,n){p(this,a);var i=u(this,e.call(this,t));return i._callbackResult=n,i._map=t,i._polygonsObjectManager=o,i._labelsObjectManager=new l,i._labelsState=new WeakMap,i._currentConfiguredVisibility=new WeakMap,i._currentVisibility=new WeakMap,i._initData(),i}return t(a,e),a.prototype.destroy=function(){this._deleteLabelsOverlaysListener(),this._deleteLabelStateListeners(),this._deletePolygonsListeners(),this._deletePolygonCollectionListeners(),this._deleteLabelCollection()},a.prototype.getLabelState=function(e){return this._labelsState.get(e)},a.prototype.getConfiguredVisibility=function(e){return this._currentConfiguredVisibility.get(e)},a.prototype.getCurrentVisibility=function(e){return this._currentVisibility.get(e)},a.prototype._initData=function(){this._map.geoObjects.add(this._labelsObjectManager),this._initLabelsOverlaysListener(),this._firstCalculatePolygons(),this._initMapListeners(),this._initPolygonCollectionListeners(),this._initPolygonsListeners(),this._initLabelCollectionListeners()},a.prototype._firstCalculatePolygons=function(){var e=this;this._clearLabels(),this._polygonsObjectManager.objects.each(function(t){"Polygon"===t.geometry.type&&(e._setInLabelState(t,"visible",void 0),e._setInLabelState(t,"isNeedUpdate",!0),e._initLabelStateListener(t),e._calculatePolygonLabelData(t).then(function(o){e._setInLabelState(t,"label",o),o.addToObjectManager()}))})},a.prototype._calculatePolygons=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){"Polygon"===t.geometry.type&&e._analyzeAndSetLabelData(t,["dot","label"],e._getFromLabelState(t,"label"))})},a.prototype._analyzeAndSetLabelData=function(e,t,o,a){var n=this;o&&r(function(){var i=o.setDataByZoom(n._map.getZoom(),t,a);i&&(n._setCurrentConfiguredVisibility(e,i.visible,i.visibleForce),n._setCurrentVisibility(e,i.visibleType))})},a.prototype._setCurrentConfiguredVisibility=function(e,t,o){var a=o&&-1!==["dot","label","none"].indexOf(o)?o:t;this._currentConfiguredVisibility.set(e,a)},a.prototype._setCurrentVisibility=function(e,t){this._currentVisibility.set(e,-1!==["dot","label"].indexOf(t)?t:"none")},a.prototype._calculatePolygonLabelData=function(e,t){var o=this.getOptions(e),a=this.getZoomRangeOptions(e),n=t?this._getFromLabelState(e,"label"):new s(this._map,e,this._labelsObjectManager);return n.setLabelData(o,a),Promise.resolve(n)},a.prototype._initLabelStateListener=function(e){var t=this,o=new i(this._labelsState.get(e));this._setInLabelState(e,"labelMonitor",o),o.add("visible",function(o){t._analyzeAndSetLabelData(e,["dot","label"],t._getFromLabelState(e,"label"),o)})},a.prototype._initLabelsOverlaysListener=function(){this._labelsObjectManager.objects.overlays.events.add(["add","remove"],this._labelsOverlaysEventHandler,this)},a.prototype._getLabelType=function(e){return-1!==e.indexOf("label#")?"label":"dot"},a.prototype._labelOverlaysGeometryChangeHandler=function(e){var t=e.get("target"),o=t._data.id,a=this._getLabelType(o);this._getLayoutAndAnalyze(t,o,a)},a.prototype._getLayoutAndAnalyze=function(e,t,o){var a=this;e.getLayout().then(function(e){var n=a._labelsObjectManager.objects.getById(t);if(n){var i=n.properties.labelPolygon,l=a._getFromLabelState(i,"label");l.setLayout(o,e),a._analyzeAndSetLabelData(i,[o],l)}})},a.prototype._labelsOverlaysEventHandler=function(e){var t=this,o=e.get("objectId"),a=this._getLabelType(o),n=e.get("overlay");switch(e.get("type")){case"add":n.events.add("geometrychange",this._labelOverlaysGeometryChangeHandler,this),r(function(){t._getLayoutAndAnalyze(n,o,a)});break;case"remove":n.events.remove("geometrychange",this._labelOverlaysGeometryChangeHandler,this)}},a.prototype._setInLabelState=function(e,t,o){var a=this._labelsState.get(e);a||(a=new n,this._labelsState.set(e,a)),a.set(t,o)},a.prototype._getFromLabelState=function(e,t){var o=this._labelsState.get(e);if(o)return o.get(t)},a.prototype._clearLabels=function(){this._labelsObjectManager.removeAll()},a.prototype._clearVisibilityInLabelsState=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){e._setInLabelState(t,"visible",void 0)})},a.prototype._initMapListeners=function(){var e=this;this.initMapListeners(function(){e._clearVisibilityInLabelsState()})},a.prototype._initPolygonCollectionListeners=function(){this._polygonsObjectManager.objects.events.add(["add","remove"],this._polygonCollectionEventHandler,this)},a.prototype._polygonCollectionEventHandler=function(e){switch(e.get("type")){case"add":var t=this._polygonsObjectManager.objects.getById(e.get("objectId"));this._recalculateNewPolygon(t);break;case"remove":var o=e.get("child"),a=this._getFromLabelState(o,"label");a&&a.destroy()}},a.prototype._recalculateNewPolygon=function(e){var t=this;this._calculatePolygonLabelData(e).then(function(o){t._setInLabelState(e,"label",o),t._setInLabelState(e,"visible",void 0),t._setInLabelState(e,"isNeedUpdate",!0),t._initLabelStateListener(e),o.addToObjectManager()})},a.prototype._initPolygonsListeners=function(){this._polygonsObjectManager.objects.events.add(["optionschange","objectoptionschange"],this._onPolygonOptionsChangeHandler,this)},a.prototype._onPolygonOptionsChangeHandler=function(e){var t=this,o=this._polygonsObjectManager.objects.getById(e.get("objectId"));o&&this._calculatePolygonLabelData(o,!0).then(function(a){a.setVisibility("phantom"),t._setInLabelState(o,"label",a),a.setLayoutTemplate(),a.setNewOptions(o.options),t._getLabelsOverlays(e.get("objectId")).then(function(e){var n=["dot","label"];e.forEach(function(e,t){a.setLayout(n[t],e)}),t._analyzeAndSetLabelData(o,n,t._getFromLabelState(o,"label"))})})},a.prototype._getLabelsOverlays=function(e){var t=this,a=["dot","_dot","label","_label"].reduce(function(o,a){var n=t._labelsObjectManager.objects.overlays.getById(a+"#"+e),i="_"===a[0]?a.slice(1):a;return n&&(o[i]=n),o},{}),n=o(a).map(function(e){return a[e].getLayout()});return Promise.all(n)},a.prototype._initLabelCollectionListeners=function(){var e=this,t=new c({controllers:[{onBeforeEventFiring:function(t,o,a){var n=a.get("objectId");if(!n)return!1;var i=n.split("#")[1];i=isNaN(Number(i))?i:Number(i);var l=e._polygonsObjectManager.objects.getById(i),s=e._labelsObjectManager.objects.getById(n);return(!s||"phantom"!==s.options.pane)&&(l&&e._polygonsObjectManager.events.fire("label"+o,{objectId:i,type:"label"+o}),!1)}}]});this._labelsObjectManager.events.setParent(t)},a.prototype._deleteLabelStateListeners=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){"Polygon"===t.geometry.type&&e._deleteLabelStateListener(t)})},a.prototype._deleteLabelStateListener=function(e){var t=this._getFromLabelState(e,"labelMonitor");t&&t.removeAll()},a.prototype._deleteLabelsOverlaysListener=function(){this._labelsObjectManager.objects.overlays.events.remove(["add","remove"],this._labelsOverlaysEventHandler,this)},a.prototype._deletePolygonsListeners=function(){this._polygonsObjectManager.objects.events.remove(["optionschange","objectoptionschange"],this._onPolygonOptionsChangeHandler,this)},a.prototype._deletePolygonCollectionListeners=function(){this._polygonsObjectManager.objects.events.remove(["add","remove"],this._polygonCollectionEventHandler,this),this.destroyMapListeners()},a.prototype._deleteLabelCollection=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){var o=e._getFromLabelState(t,"label");"Polygon"===t.geometry.type&&o&&o.destroy()}),this._clearLabels()},a}(a))}),ymaps.modules.define("src.polylabel.PolylabelObjectManager1",["util.defineClass","src.polylabel.PolylabelBase","data.Manager","Monitor","ObjectManager","src.label.ObjectManager.Label1","src.label.LabelData","system.nextTick","src.util.zoom.setZoomVisibility","event.Manager"],function(e,t,o,a,n,i,l,s,r,c,p){function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}e(function(e){function o(t,a){u(this,o);var n=b(this,e.call(this,t));return n._map=t,n._polygonsObjectManager=a,n._labelsObjectManager=new i,n._labelsState=new WeakMap,n._currentConfiguredVisibility=new WeakMap,n._currentVisibility=new WeakMap,n._layoutTemplateCache={},n._initData(),n}return t(o,e),o.prototype.destroy=function(){this._deleteLabelStateListeners(),this._deletePolygonsListeners(),this._deletePolygonCollectionListeners(),this._deleteLabelCollection()},o.prototype.getLabelState=function(e){return this._labelsState.get(e)},o.prototype.getConfiguredVisibility=function(e){return this._currentConfiguredVisibility.get(e)},o.prototype.getCurrentVisibility=function(e){return this._currentVisibility.get(e)},o.prototype._initData=function(){this._map.geoObjects.add(this._labelsObjectManager),this._initOverlaysListener(),this._firstCalculatePolygons(),this._initMapListeners(),this._initPolygonCollectionListeners(),this._initPolygonsListeners(),this._initLabelCollectionListeners()},o.prototype._firstCalculatePolygons=function(){var e=this;this._clearLabels(),this._polygonsObjectManager.objects.each(function(t){"Polygon"===t.geometry.type&&(e._setInLabelState(t,"visible",void 0),e._setInLabelState(t,"isNeedUpdate",!0),e._initLabelStateListener(t),e._calculatePolygonLabelData(t).then(function(o){e._setInLabelState(t,"label",o),o.addToObjectManager()}))})},o.prototype._calculatePolygons=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){"Polygon"===t.geometry.type&&e._analyzeAndSetLabelData(t,e._getFromLabelState(t,"label"))})},o.prototype._analyzeAndSetLabelData=function(e,t,o){if(!t)return Promise.resolve();var a=t.setDataByZoom(this._map.getZoom(),o);return this._setCurrentConfiguredVisibility(e,a.visible,a.visibleForce),this._setCurrentVisibility(e,a.visibleType),Promise.resolve()},o.prototype._setCurrentConfiguredVisibility=function(e,t,o){var a=o&&-1!==["dot","label","none"].indexOf(o)?o:t;this._currentConfiguredVisibility.set(e,a)},o.prototype._setCurrentVisibility=function(e,t){this._currentVisibility.set(e,-1!==["dot","label"].indexOf(t)?t:"none")},o.prototype._calculatePolygonLabelData=function(e,t){var o=this.getOptions(e),a=this.getZoomRangeOptions(e),n=(this.getProperties(e),t?this._getFromLabelState(e,"label"):new l(e,this._labelsObjectManager,this._layoutTemplateCache));return n.setLabelData(o,a),Promise.resolve(n)},o.prototype._initLabelStateListener=function(e){var t=this,o=new n(this._labelsState.get(e));this._setInLabelState(e,"labelMonitor",o),o.add("visible",function(o){t._analyzeAndSetLabelData(e,t._getFromLabelState(e,"label"),o)})},o.prototype._initOverlaysListener=function(){this._labelsObjectManager.objects.overlays.events.add("add",this._overlaysChangehandler,this)},o.prototype._overlaysChangehandler=function(e){var t=this,o=String(e.get("objectId")),a=-1!==o.indexOf("label#")?"label":"dot",n=e.get("overlay");r(function(){n.getLayout().then(function(e){var n=t._labelsObjectManager.objects.getById(o);if(n){var i=n.properties._labelPolygon,l=t._getFromLabelState(i,"label"),s=l.getLabelData();l.setLayout(a,e),t._getFromLabelState(i,"isNeedUpdate")&&c(t._map,s,l).then(function(){t._setInLabelState(i,"isNeedUpdate",!1),t._analyzeAndSetLabelData(i,l)})}})})},o.prototype._setInLabelState=function(e,t,o){var n=this._labelsState.get(e);n||(n=new a,this._labelsState.set(e,n)),n.set(t,o)},o.prototype._getFromLabelState=function(e,t){var o=this._labelsState.get(e);if(o)return o.get(t)},o.prototype._clearLabels=function(){this._labelsObjectManager.removeAll()},o.prototype._clearVisibilityInLabelsState=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){e._setInLabelState(t,"visible",void 0)})},o.prototype._initMapListeners=function(){var e=this;this.initMapListeners(function(){e._clearVisibilityInLabelsState(),e._calculatePolygons()})},o.prototype._initPolygonCollectionListeners=function(){this._polygonsObjectManager.objects.events.add(["add","remove"],this._polygonCollectionEventHandler,this)},o.prototype._polygonCollectionEventHandler=function(e){switch(e.get("type")){case"add":var t=this._polygonsObjectManager.objects.getById(e.get("objectId"));this._recalculateNewPolygon(t);break;case"remove":var o=e.get("child"),a=this._getFromLabelState(o,"label");a&&a.destroy()}},o.prototype._recalculateNewPolygon=function(e){var t=this;this._calculatePolygonLabelData(e).then(function(o){t._setInLabelState(e,"label",o),t._setInLabelState(e,"visible",void 0),t._setInLabelState(e,"isNeedUpdate",!0),t._initLabelStateListener(e),o.addToObjectManager()})},o.prototype._initPolygonsListeners=function(){this._polygonsObjectManager.objects.events.add(["optionschange","objectoptionschange"],this._onPolygonOptionsChangeHandler,this)},o.prototype._onPolygonOptionsChangeHandler=function(e){var t=this._polygonsObjectManager.objects.getById(e.get("objectId"));t&&this._calculatePolygonLabelData(t,!0).then(function(e){})},o.prototype._initLabelCollectionListeners=function(){var e=this,t=new p({controllers:[{onBeforeEventFiring:function(t,o,a){var n=a.get("objectId");if(!n)return!1;var i=n.split("#")[1],l=e._polygonsObjectManager.objects.getById(i),s=e._labelsObjectManager.objects.getById(n);return(!s||"phantom"!==s.options.pane)&&(l&&e._polygonsObjectManager.events.fire("label"+o,{objectId:i,type:"label"+o}),!1)}}]});this._labelsObjectManager.events.setParent(t)},o.prototype._deleteLabelStateListeners=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){"Polygon"===t.geometry.type&&e._deleteLabelStateListener(t)})},o.prototype._deleteLabelStateListener=function(e){var t=this._getFromLabelState(e,"labelMonitor");t&&t.removeAll()},o.prototype._deletePolygonsListeners=function(){this._polygonsObjectManager.objects.events.remove(["optionschange","objectoptionschange"],this._onPolygonOptionsChangeHandler,this)},o.prototype._deletePolygonCollectionListeners=function(){this._polygonsObjectManager.objects.events.remove(["add","remove"],this._polygonCollectionEventHandler,this),this.destroyMapListeners()},o.prototype._deleteLabelCollection=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){var o=e._getFromLabelState(t,"label");"Polygon"===t.geometry.type&&o&&o.destroy()}),this._clearLabels()},o}(o))}),ymaps.modules.define("src.polylabel.PolylabelObjectManager2",["util.defineClass","util.objectKeys","src.polylabel.PolylabelBase","data.Manager","Monitor","ObjectManager","src.label.ObjectManager.Label","system.nextTick","event.Manager"],function(e,t,o,a,n,i,l,s,r,c){function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}e(function(e){function a(t,o,n){p(this,a);var i=u(this,e.call(this,t));return i._callbackResult=n,i._map=t,i._polygonsObjectManager=o,i._labelsObjectManager=new l,i._labelsState=new WeakMap,i._currentConfiguredVisibility=new WeakMap,i._currentVisibility=new WeakMap,i._initData(),i}return t(a,e),a.prototype.destroy=function(){this._deleteLabelsOverlaysListener(),this._deleteLabelStateListeners(),this._deletePolygonsListeners(),this._deletePolygonCollectionListeners(),this._deleteLabelCollection()},a.prototype.getLabelState=function(e){return this._labelsState.get(e)},a.prototype.getConfiguredVisibility=function(e){return this._currentConfiguredVisibility.get(e)},a.prototype.getCurrentVisibility=function(e){return this._currentVisibility.get(e)},a.prototype._initData=function(){this._map.geoObjects.add(this._labelsObjectManager),this._initLabelsOverlaysListener(),this._firstCalculatePolygons(),this._initMapListeners(),this._initPolygonCollectionListeners(),this._initPolygonsListeners(),this._initLabelCollectionListeners()},a.prototype._firstCalculatePolygons=function(){var e=this;this._clearLabels(),this._polygonsObjectManager.objects.each(function(t){"Polygon"===t.geometry.type&&(e._setInLabelState(t,"visible",void 0),e._setInLabelState(t,"isNeedUpdate",!0),e._initLabelStateListener(t),e._calculatePolygonLabelData(t).then(function(o){e._setInLabelState(t,"label",o),o.addToObjectManager()}))})},a.prototype._calculatePolygons=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){"Polygon"===t.geometry.type&&e._analyzeAndSetLabelData(t,["dot","label"],e._getFromLabelState(t,"label"))})},a.prototype._analyzeAndSetLabelData=function(e,t,o,a){var n=this;o&&r(function(){var i=o.setDataByZoom(n._map.getZoom(),t,a);i&&(n._setCurrentConfiguredVisibility(e,i.visible,i.visibleForce),n._setCurrentVisibility(e,i.visibleType))})},a.prototype._setCurrentConfiguredVisibility=function(e,t,o){var a=o&&-1!==["dot","label","none"].indexOf(o)?o:t;this._currentConfiguredVisibility.set(e,a)},a.prototype._setCurrentVisibility=function(e,t){this._currentVisibility.set(e,-1!==["dot","label"].indexOf(t)?t:"none")},a.prototype._calculatePolygonLabelData=function(e,t){var o=this.getOptions(e),a=this.getZoomRangeOptions(e),n=t?this._getFromLabelState(e,"label"):new s(this._map,e,this._labelsObjectManager);return n.setLabelData(o,a),Promise.resolve(n)},a.prototype._recalculateLabelsCenter=function(e){var t=this;this._polygonsObjectManager.objects.each(function(o){var a=t._labelsObjectManager.objects.getById("label#"+o.id),n=t._getFromLabelState(o,"label").getLabelData().getAll();a.geometry.coordinates=n.zoomInfo[e].center||n.autoCenter})},a.prototype._initLabelStateListener=function(e){var t=this,o=new i(this._labelsState.get(e));this._setInLabelState(e,"labelMonitor",o),o.add("visible",function(o){t._analyzeAndSetLabelData(e,["dot","label"],t._getFromLabelState(e,"label"),o)})},a.prototype._initLabelsOverlaysListener=function(){this._labelsObjectManager.objects.overlays.events.add(["add","remove"],this._labelsOverlaysEventHandler,this)},a.prototype._getLabelType=function(e){return-1!==e.indexOf("label#")?"label":"dot"},a.prototype._labelOverlaysGeometryChangeHandler=function(e){var t=e.get("target"),o=t._data.id,a=this._getLabelType(o);this._getLayoutAndAnalyze(t,o,a)},a.prototype._getLayoutAndAnalyze=function(e,t,o){var a=this;e.getLayout().then(function(e){var n=a._labelsObjectManager.objects.getById(t);if(n){var i=n.properties.labelPolygon,l=a._getFromLabelState(i,"label");l.setLayout(o,e),a._analyzeAndSetLabelData(i,[o],l)}})},a.prototype._labelsOverlaysEventHandler=function(e){var t=this,o=e.get("objectId"),a=this._getLabelType(o),n=e.get("overlay");switch(e.get("type")){case"add":n.events.add("geometrychange",this._labelOverlaysGeometryChangeHandler,this),r(function(){t._getLayoutAndAnalyze(n,o,a)});break;case"remove":n.events.remove("geometrychange",this._labelOverlaysGeometryChangeHandler,this)}},a.prototype._setInLabelState=function(e,t,o){var a=this._labelsState.get(e);a||(a=new n,this._labelsState.set(e,a)),a.set(t,o)},a.prototype._getFromLabelState=function(e,t){var o=this._labelsState.get(e);if(o)return o.get(t)},a.prototype._clearLabels=function(){this._labelsObjectManager.removeAll()},a.prototype._clearVisibilityInLabelsState=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){e._setInLabelState(t,"visible",void 0)})},a.prototype._initMapListeners=function(){var e=this;this.initMapListeners(function(t){e._recalculateLabelsCenter(t),e._clearVisibilityInLabelsState()})},a.prototype._initPolygonCollectionListeners=function(){this._polygonsObjectManager.objects.events.add(["add","remove"],this._polygonCollectionEventHandler,this)},a.prototype._polygonCollectionEventHandler=function(e){switch(e.get("type")){case"add":var t=this._polygonsObjectManager.objects.getById(e.get("objectId"));this._recalculateNewPolygon(t);break;case"remove":var o=e.get("child"),a=this._getFromLabelState(o,"label");a&&a.destroy()}},a.prototype._recalculateNewPolygon=function(e){var t=this;this._calculatePolygonLabelData(e).then(function(o){t._setInLabelState(e,"label",o),t._setInLabelState(e,"visible",void 0),t._setInLabelState(e,"isNeedUpdate",!0),t._initLabelStateListener(e),o.addToObjectManager()})},a.prototype._initPolygonsListeners=function(){this._polygonsObjectManager.objects.events.add(["optionschange","objectoptionschange"],this._onPolygonOptionsChangeHandler,this)},a.prototype._onPolygonOptionsChangeHandler=function(e){var t=this,o=this._polygonsObjectManager.objects.getById(e.get("objectId"));o&&this._calculatePolygonLabelData(o,!0).then(function(a){a.setVisibility("phantom"),t._setInLabelState(o,"label",a),a.setLayoutTemplate(),a.setNewOptions(o.options),t._getLabelsOverlays(e.get("objectId")).then(function(e){var n=["dot","label"];e.forEach(function(e,t){a.setLayout(n[t],e)}),t._analyzeAndSetLabelData(o,n,t._getFromLabelState(o,"label"))})})},a.prototype._getLabelsOverlays=function(e){var t=this,a=["dot","_dot","label","_label"].reduce(function(o,a){var n=t._labelsObjectManager.objects.overlays.getById(a+"#"+e),i="_"===a[0]?a.slice(1):a;return n&&(o[i]=n),o},{}),n=o(a).map(function(e){return a[e].getLayout()});return Promise.all(n)},a.prototype._initLabelCollectionListeners=function(){var e=this,t=new c({controllers:[{onBeforeEventFiring:function(t,o,a){var n=a.get("objectId");if(!n)return!1;var i=n.split("#")[1];i=isNaN(Number(i))?i:Number(i);var l=e._polygonsObjectManager.objects.getById(i),s=e._labelsObjectManager.objects.getById(n);return(!s||"phantom"!==s.options.pane)&&(l&&e._polygonsObjectManager.events.fire("label"+o,{objectId:i,type:"label"+o}),!1)}}]});this._labelsObjectManager.events.setParent(t)},a.prototype._deleteLabelStateListeners=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){"Polygon"===t.geometry.type&&e._deleteLabelStateListener(t)})},a.prototype._deleteLabelStateListener=function(e){var t=this._getFromLabelState(e,"labelMonitor");t&&t.removeAll()},a.prototype._deleteLabelsOverlaysListener=function(){this._labelsObjectManager.objects.overlays.events.remove(["add","remove"],this._labelsOverlaysEventHandler,this)},a.prototype._deletePolygonsListeners=function(){this._polygonsObjectManager.objects.events.remove(["optionschange","objectoptionschange"],this._onPolygonOptionsChangeHandler,this)},a.prototype._deletePolygonCollectionListeners=function(){this._polygonsObjectManager.objects.events.remove(["add","remove"],this._polygonCollectionEventHandler,this),this.destroyMapListeners()},a.prototype._deleteLabelCollection=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){var o=e._getFromLabelState(t,"label");"Polygon"===t.geometry.type&&o&&o.destroy()}),this._clearLabels()},a}(a))}),ymaps.modules.define("util.createPolylabel",["src.polylabel.PolylabelCollection","src.polylabel.PolylabelObjectManager","ObjectManager"],function(e,t,o,a){e(function(e,n,i){return n instanceof a?new o(e,n,i):new t(e,n,i)})}),ymaps.modules.define("src.util.checkPointPosition",[],function(e){function t(e,t,i){var l=o(i,t),s=o(e,t),r=l[0]*s[1]-s[0]*l[1];return r>0?"LEFT":r<0?"RIGHT":l[0]*s[0]<0||l[1]*s[1]<0?"BEHIND":a(l)<a(s)?"BEYOND":n(t,e)?"ORIGIN":n(i,e)?"DESTINATION":"BETWEEN"}function o(e,t){return[e[0]-t[0],e[1]-t[1]]}function a(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))}function n(e,t){return e[0]===t[0]&&e[1]===t[1]}function i(e,o){var a=o[0],n=o[1];switch(t(e,a,n)){case"LEFT":return a[1]<e[1]&&e[1]<=n[1]?"CROSSING":"INESSENTIAL";case"RIGHT":return n[1]<e[1]&&e[1]<=a[1]?"CROSSING":"INESSENTIAL";case"BETWEEN":case"ORIGIN":case"DESTINATION":return"TOUCHING";default:return"INESSENTIAL"}}e(function(e,t){for(var o=0,a=0;a<t.length-1;a++)switch(i(e,[t[a],t[a+1]])){case"TOUCHING":return"BOUNDARY";case"CROSSING":o=1-o}return o?"INSIDE":"OUTSIDE"})}),ymaps.modules.define("src.util.createDefaultLabelData",["src.config"],function(e,t){var o=t.MIN_ZOOM,a=t.MAX_ZOOM;e(function(){for(var e={zoomInfo:{},autoCenter:[0,0],polygonIndex:0,dotSize:{height:0,width:0}},t=o;t<=a;t++)e.zoomInfo[t]={visible:"none",visibleForce:"auto",center:void 0,style:{className:void 0,textSize:void 0,textColor:void 0},labelSize:{height:0,width:0},labelOffset:[0,0],permissibleInaccuracyOfVisibility:0};return e})}),ymaps.modules.define("src.util.getPolesOfInaccessibility",["util.calculateArea","GeoObject"],function(e,t,o){function a(e,t){if(!(this instanceof a))return new a(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||n,this.length>0)for(var o=this.length>>1;o>=0;o--)this._down(o)}function n(e,t){return e<t?-1:e>t?1:0}function i(e,t,o){t=t||1;for(var a,n,i,r,p=0;p<e[0].length;p++){var b=e[0][p];(!p||b[0]<a)&&(a=b[0]),(!p||b[1]<n)&&(n=b[1]),(!p||b[0]>i)&&(i=b[0]),(!p||b[1]>r)&&(r=b[1])}var y=i-a,h=r-n,g=Math.min(y,h),d=g/2,f=new u(null,l);if(0===g)return[a,n];for(var _=a;_<i;_+=g)for(var m=n;m<r;m+=g)f.push(new s(_+d,m+d,d,e));var v=c(e),L=new s(a+y/2,n+h/2,0,e);L.d>v.d&&(v=L);for(var C=f.length;f.length;){var O=f.pop();O.d>v.d&&(v=O,o&&console.error("found best %d after %d probes",Math.round(1e4*O.d)/1e4,C)),O.max-v.d<=t||(d=O.h/2,f.push(new s(O.x-d,O.y-d,d,e)),f.push(new s(O.x+d,O.y-d,d,e)),f.push(new s(O.x-d,O.y+d,d,e)),f.push(new s(O.x+d,O.y+d,d,e)),C+=4)}return o&&(console.error("num probes: "+C),console.error("best distance: "+v.d)),[v.x,v.y]}function l(e,t){return t.max-e.max}function s(e,t,o,a){this.x=e,this.y=t,this.h=o,this.d=r(e,t,a),this.max=this.d+this.h*Math.SQRT2}function r(e,t,o){for(var a=!1,n=1/0,i=0;i<o.length;i++)for(var l=o[i],s=0,r=l.length,c=r-1;s<r;c=s++){var u=l[s],b=l[c];u[1]>t!=b[1]>t&&e<(b[0]-u[0])*(t-u[1])/(b[1]-u[1])+u[0]&&(a=!a),n=Math.min(n,p(e,t,u,b))}return(a?1:-1)*Math.sqrt(n)}function c(e){for(var t=0,o=0,a=0,n=e[0],i=0,l=n.length,r=l-1;i<l;r=i++){var c=n[i],p=n[r],u=c[0]*p[1]-p[0]*c[1];o+=(c[0]+p[0])*u,a+=(c[1]+p[1])*u,t+=3*u}return 0===t?new s(n[0][0],n[0][1],0,e):new s(o/t,a/t,0,e)}function p(e,t,o,a){var n=o[0],i=o[1],l=a[0]-n,s=a[1]-i;if(0!==l||0!==s){var r=((e-n)*l+(t-i)*s)/(l*l+s*s);r>1?(n=a[0],i=a[1]):r>0&&(n+=l*r,i+=s*r)}return l=e-n,s=t-i,l*l+s*s}e(function(e,a,n){if(void 0===t)throw new Error("Didn't find calculateArea module");var l=Number.MIN_VALUE,s=0,r=void 0;if(e.length>1){for(var c=0;c<e.length;c++){var p=new o({geometry:{type:"Polygon",coordinates:[e[c]]}}),u=Math.round(t(p));l<u&&(l=u,s=c)}r=[e[s]]}else r=e;return{center:i(r,a,n),index:s}}),a.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return--this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,o=this.compare,a=t[e];e>0;){var n=e-1>>1,i=t[n];if(o(a,i)>=0)break;t[e]=i,e=n}t[e]=a},_down:function(e){for(var t=this.data,o=this.compare,a=this.length>>1,n=t[e];e<a;){var i=1+(e<<1),l=i+1,s=t[i];if(l<this.length&&o(t[l],s)<0&&(i=l,s=t[l]),o(s,n)>=0)break;t[e]=s,e=i}t[e]=n}};var u=a}),ymaps.modules.define("src.util.SpeedTester",[],function(e){function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(function(){function e(){t(this,e)}return e.prototype.start=function(){this._start=performance.now()},e.prototype.finish=function(){return performance.now()-this._start},e.prototype.startByCount=function(e){this._count=e},e.prototype.decrementCountAndCheck=function(){return--this._count<=0},e}())}),ymaps.modules.define("src.util.stringReplacer",[],function(e){e(function(e,t){var o=e;return t.forEach(function(e,t){o=o.replace(new RegExp("\\$"+(t+1),"g"),e)}),o})}),ymaps.modules.define("src.util.zoom.getFirstZoomInside",["src.util.checkPointPosition","src.config"],function(e,t,o){function a(e,t,o,a,n,i){var l=e.options.get("projection").toGlobalPixels(t,o),s=a.width,r=a.height;l[0]+=n[0],l[1]+=n[1];var c=[],p=[];return c.push([l[0]-s/2,l[1]-r/2],[l[0]-s/2,l[1]+r/2],[l[0]+s/2,l[1]-r/2],[l[0]+s/2,l[1]+r/2]),p.push([c[0][0]+i>l[0]?l[0]:c[0][0]+i,c[0][1]+i>l[1]?l[1]:c[0][1]+i],[c[1][0]+i>l[0]?l[0]:c[1][0]+i,c[1][1]-i<l[1]?l[1]:c[1][1]-i],[c[2][0]-i<l[0]?l[0]:c[2][0]-i,c[2][1]+i>l[1]?l[1]:c[2][1]+i],[c[3][0]-i<l[0]?l[0]:c[3][0]-i,c[3][1]-i<l[1]?l[1]:c[3][1]-i]),{normal:c,withInaccuracy:p}}function n(e,o,a,n){for(var i=0;i<a.length;i++){var l=e.options.get("projection").fromGlobalPixels(a[i],n);if("INSIDE"!==t(l,o))return!1}return!0}e(function(e,t,i,l,s,r){for(var c=o.MIN_ZOOM,p=o.MAX_ZOOM,u=void 0;c<p;){u=Math.floor((c+p)/2);var b=isNaN(Number(r))?0:Number(r),y=a(e,t,u,l,s||[0,0],b);n(e,i,y.normal,u)||0!==b&&n(e,i,y.withInaccuracy,u)?p=u:c=u+1}return c})}),ymaps.modules.define("src.util.zoom.parseZoomData",["util.array","util.objectKeys","src.config"],function(e,t,o,a){function n(e,t,o){e[t]=o}function i(e,t,o){if(isNaN(Number(t))){var a=t.split("_").map(Number);if(!isNaN(a[0])&&!isNaN(a[1]))for(var n=a[0]<r?r:a[0],i=a[1]>c?c:a[1];n<=i;)e[n]=o,n++}else e[Number(t)]=o}function l(e){for(var t={},o=r;o<=c;o++)t[o]=e;return t}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=a.MIN_ZOOM,c=a.MAX_ZOOM;e(function(e){var a=["number","string","boolean","object"];return e&&!t.isArray(e)&&"object"===(void 0===e?"undefined":s(e))?o(e).reduce(function(t,o){return"string"==typeof o?i(t,o,e[o]):"number"==typeof o&&n(t,o,e[o]),t},l()):a.includes(void 0===e?"undefined":s(e))?l(e):void 0})}),ymaps.modules.define("src.util.zoom.setOneZoomVisibility",["src.util.zoom.getFirstZoomInside","src.label.util.getLayoutSize"],function(e,t,o){function a(e,t,o){var a=["none","dot","label"],n=e;return o&&(n=a.indexOf(t)>a.indexOf(e)?t:e),n}var n={label:function(e,n,i,l,s,r){var c=o(r);if(!c)return!1;var p=l.getAll(),u=p.zoomInfo[n];l.setZoomInfo(n,"labelSize",c);var b=t(e,u.center||p.autoCenter,s,c,u.labelOffset,u.permissibleInaccuracyOfVisibility);return l.setZoomInfo(n,"visible",a(u.visible,"label",n>=b)),!0},dot:function(e,n,i,l,s,r){var c=o(r);if(!c)return!1;var p=l.getAll(),u=l.getZoomInfo(n);if(p.dotFirstZoom||"number"==typeof p.dotFirstZoom&&0===p.dotFirstZoom)return l.setZoomInfo(n,"visible",a(u.visible,"dot",n>=p.dotFirstZoom)),!0;l.setData("dotSize",c);var b=t(e,u.center||p.autoCenter,s,c,u.labelOffset,u.permissibleInaccuracyOfVisibility);return l.setZoomInfo(n,"visible",a(u.visible,"dot",n>=b)),l.setData("dotFirstZoom",b),!0}};e(function(e,t,o,a){var i=o.getLabelData(),l=i.getPolygonCoords();return n[a](e,t,o,i,l,o.getLayout(a))})}),ymaps.modules.define("src.util.zoom.setZoomVisibility",["util.objectKeys","src.util.zoom.getFirstZoomInside","src.label.util.getLayoutSize"],function(e,t,o,a){function n(e,t,o){var a=["none","dot","label"],n=e;return o&&(n=a.indexOf(t)>a.indexOf(e)?t:e),n}function i(e,a,i,l,s,r){var c=i.getAll();t(c.zoomInfo).forEach(function(t){var a=i.getZoomInfo(t),s=o(e,a.center||c.autoCenter,l,r,a.labelOffset,a.permissibleInaccuracyOfVisibility);i.setZoomInfo(t,"visible",n(a.visible,"dot",t>=s))})}function l(e,t,i,l,s,r,c){var p=i.getAll(),u=p.zoomInfo[l],b=(u.center||p.autoCenter,u.style.className,u.style.textSize,a(r));if(b){t.setStyles(u.style),i.setZoomInfo(l,"labelSize",b);var y=o(e,u.center||p.autoCenter,s,b,u.labelOffset,u.permissibleInaccuracyOfVisibility);i.setZoomInfo(l,"visible",n(u.visible,"label",l>=y))}}e(function(e,o){var n=o.getLabelData(),s=n.getPolygonCoords(),r=a(o.getLayout("dot"));r&&(n.setData("dotSize",r),i(e,0,n,s,o.getLayout("dot"),r));return t(n.getZoomInfo()).forEach(function(t){l(e,o,n,t,s,o.getLayout("label"))}),Promise.resolve()})});