ymaps.modules.define("setCenter",["getPolesOfInaccessibility","parseZoomData"],function(e,t,n){e(function(e,o,r){var a=r.labelCenterCoords,i=t(o.geometry.getCoordinates(),1);if(e.autoCenter=i.center,e.polygonIndex=i.index,"default"!==a){if("[object Object]"!==Object.prototype.toString.call(a))throw new Error("Center coords is not object");Object.keys(a).forEach(function(t){n(t,!0).forEach(function(n){e.data[n].center=a[t]})})}})}),ymaps.modules.define("config",[],function(e){e({MIN_ZOOM:0,MAX_ZOOM:19})}),ymaps.modules.define("createLabel",[],function(e){e(function(e){var t=e.labelHtml,n=e.labelText,o=e.labelTextClassName,r=void 0;if("default"!==t)r=t;else{var a=document.createElement("div");a.innerHTML="default"!==n?n:null,"default"!==o&&(a.className=o),r=a}var i=ymaps.templateLayoutFactory.createClass("<div {% style %}position: {{properties.position}}; top: {{properties.top}}px;left: {{properties.left}}px; {% endstyle %}>$[properties.html]</div>");return new ymaps.Placemark([0,0],{html:r.outerHTML,top:0,left:0,position:"absolute"},{iconLayout:i})})}),ymaps.modules.define("util.polylabel",["createLabel","setCenter","createDefaultLabelData","setZoomVisibility"],function(e,t,n,o,r){function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(function(){function e(t,n){a(this,e),this._map=t,this._collections=n,this._labelsCollections=new ymaps.GeoObjectCollection,this._map.geoObjects.add(this._labelsCollections),this._initData()}return e.prototype.update=function(){this._calculateCollections(!0)},e.prototype.destroy=function(){this._labelsCollections.removeAll(),this._deleteListeners()},e.prototype._initData=function(){var e=this;this._calculateCollections(!0).then(function(){e._initMapListeners(),e._initCollectionListeners()})},e.prototype._calculateCollections=function(e){var t=this;return new Promise(function(n){e&&(t._labelsCollections.removeAll(),t._labelsCollections.options.set({pane:"phantom"})),t._collections.each(function(o){var r=void 0;e&&(r=new ymaps.GeoObjectCollection,t._labelsCollections.add(r)),o.each(function(n){e?t._calculateGeoObject(n,r).then(function(){t._analyseLabelData(n)}):t._analyseLabelData(n)}),n()})})},e.prototype._analyseLabelData=function(e){var t=e.properties.get("labelData"),n=t.data,o=t.autoCenter,r=t.label;(n=n[this._map.getZoom()]).visibleForce||n.visible?(r.geometry.setCoordinates(n.center||o),r.options.set({pane:"places"})):r.options.set({pane:"phantom"})},e.prototype._calculateGeoObject=function(e,a){var i=this;return new Promise(function(s){var l=i._getOptions(e),c=i._getProperties(e),u=o();n(u,e,c);var f=t(l);a.add(f),f.getOverlay().then(function(e){return e.getLayout()}).then(function(t){var n=t._element.firstChild.getBoundingClientRect();f.properties.set({top:-n.height/2,left:-n.width/2}),r(i._map,u,e,n,l.labelForceVisibleZoom),u.label=f,e.properties.set("labelData",u),s()})})},e.prototype._getOptions=function(e){var t=["labelForceVisibleZoom","labelTextClassName","labelHtml","labelText"],n=e.options,o={};return t.forEach(function(e){o[e]=n.get(e,"default")}),o},e.prototype._getProperties=function(e){var t=["labelCenterCoords"],n=e.properties,o={};return t.forEach(function(e){o[e]=n.get(e,"default")}),o},e.prototype._initMapListeners=function(){var e=this;this._map.events.add("boundschange",function(t){t.get("newZoom")!==t.get("oldZoom")&&e._calculateCollections()})},e.prototype._initCollectionListeners=function(){var e=this;this._collections.events.add(["add","remove"],function(t){switch(t.get("type")){case"add":case"remove":e._calculateCollections(!0)}})},e.prototype._deleteListeners=function(){this._collections.events.remove(["add","remove"]),this._map.events.remove("boundschange")},e}())}),ymaps.modules.define("calculateArea",[],function(e){function t(e){if("Feature"===e.type)return e.geometry;if(e.geometry&&e.geometry.getType)return"Circle"===e.geometry.getType()?{type:"Circle",coordinates:e.geometry.getCoordinates(),radius:e.geometry.getRadius()}:{type:e.geometry.getType(),coordinates:e.geometry.getCoordinates()};throw new Error("util.calculateArea: Unknown input object.")}function n(e){var t,n=0;switch(e.type){case"Polygon":return o(e.coordinates);case"MultiPolygon":for(t=0;t<e.coordinates.length;t++)n+=o(e.coordinates[t]);return n;case"Rectangle":return o([[e.coordinates[0],[e.coordinates[0][0],e.coordinates[1][1]],e.coordinates[1],[e.coordinates[1][0],e.coordinates[0][1]],e.coordinates[0]]]);case"Circle":return Math.PI*Math.pow(e.radius,2);case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}}function o(e){var t=0;if(e&&e.length>0){t+=Math.abs(r(e[0]));for(var n=1;n<e.length;n++)t-=Math.abs(r(e[n]))}return t}function r(e){var t,n,o,r,s,l,c=0,u=e.length,f="latlong"===ymaps.meta.coordinatesOrder?1:0,p="latlong"===ymaps.meta.coordinatesOrder?0:1;if(u>2){for(l=0;l<u;l++)l===u-2?(o=u-2,r=u-1,s=0):l===u-1?(o=u-1,r=0,s=1):(o=l,r=l+1,s=l+2),t=e[o],n=e[r],c+=(a(e[s][f])-a(t[f]))*Math.sin(a(n[p]));c=c*i*i/2}return c}function a(e){return e*Math.PI/180}e(function(e){return n(t(e))});var i=6378137}),ymaps.modules.define("checkPointPosition",[],function(e){function t(e,t,a){var i=n(a,t),s=n(e,t),l=i[0]*s[1]-s[0]*i[1];return l>0?"LEFT":l<0?"RIGHT":i[0]*s[0]<0||i[1]*s[1]<0?"BEHIND":o(i)<o(s)?"BEYOND":r(t,e)?"ORIGIN":r(a,e)?"DESTINATION":"BETWEEN"}function n(e,t){return[e[0]-t[0],e[1]-t[1]]}function o(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))}function r(e,t){return e[0]===t[0]&&e[1]===t[1]}function a(e,n){var o=n[0],r=n[1];switch(t(e,o,r)){case"LEFT":return o[1]<e[1]&&e[1]<=r[1]?"CROSSING":"INESSENTIAL";case"RIGHT":return r[1]<e[1]&&e[1]<=o[1]?"CROSSING":"INESSENTIAL";case"BETWEEN":case"ORIGIN":case"DESTINATION":return"TOUCHING";default:return"INESSENTIAL"}}e(function(e,t){for(var n=0,o=0;o<t.length-1;o++)switch(a(e,[t[o],t[o+1]])){case"TOUCHING":return"BOUNDARY";case"CROSSING":n=1-n}return n?"INSIDE":"OUTSIDE"})}),ymaps.modules.define("createDefaultLabelData",["config"],function(e,t){var n=t.MIN_ZOOM,o=t.MAX_ZOOM;e(function(){for(var e=n,t={data:{},autoCenter:[0,0],polygonIndex:0};e<=o;)t.data[e]={visible:!1,visibleForce:!1,center:null},e++;return t})}),ymaps.modules.define("getPolesOfInaccessibility",["calculateArea"],function(e,t){function n(e,t){if(!(this instanceof n))return new n(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||o,this.length>0)for(var r=this.length>>1;r>=0;r--)this._down(r)}function o(e,t){return e<t?-1:e>t?1:0}function r(e,t,n){t=t||1;for(var o,r,s,c,f=0;f<e[0].length;f++){var p=e[0][f];(!f||p[0]<o)&&(o=p[0]),(!f||p[1]<r)&&(r=p[1]),(!f||p[0]>s)&&(s=p[0]),(!f||p[1]>c)&&(c=p[1])}var h=s-o,d=c-r,m=Math.min(h,d),v=m/2,y=new u(null,a);if(0===m)return[o,r];for(var g=o;g<s;g+=m)for(var b=r;b<c;b+=m)y.push(new i(g+v,b+v,v,e));var _=l(e),C=new i(o+h/2,r+d/2,0,e);C.d>_.d&&(_=C);for(var O=y.length;y.length;){var N=y.pop();N.d>_.d&&(_=N,n&&console.error("found best %d after %d probes",Math.round(1e4*N.d)/1e4,O)),N.max-_.d<=t||(v=N.h/2,y.push(new i(N.x-v,N.y-v,v,e)),y.push(new i(N.x+v,N.y-v,v,e)),y.push(new i(N.x-v,N.y+v,v,e)),y.push(new i(N.x+v,N.y+v,v,e)),O+=4)}return n&&(console.error("num probes: "+O),console.error("best distance: "+_.d)),[_.x,_.y]}function a(e,t){return t.max-e.max}function i(e,t,n,o){this.x=e,this.y=t,this.h=n,this.d=s(e,t,o),this.max=this.d+this.h*Math.SQRT2}function s(e,t,n){for(var o=!1,r=1/0,a=0;a<n.length;a++)for(var i=n[a],s=0,l=i.length,u=l-1;s<l;u=s++){var f=i[s],p=i[u];f[1]>t!=p[1]>t&&e<(p[0]-f[0])*(t-f[1])/(p[1]-f[1])+f[0]&&(o=!o),r=Math.min(r,c(e,t,f,p))}return(o?1:-1)*Math.sqrt(r)}function l(e){for(var t=0,n=0,o=0,r=e[0],a=0,s=r.length,l=s-1;a<s;l=a++){var c=r[a],u=r[l],f=c[0]*u[1]-u[0]*c[1];n+=(c[0]+u[0])*f,o+=(c[1]+u[1])*f,t+=3*f}return 0===t?new i(r[0][0],r[0][1],0,e):new i(n/t,o/t,0,e)}function c(e,t,n,o){var r=n[0],a=n[1],i=o[0]-r,s=o[1]-a;if(0!==i||0!==s){var l=((e-r)*i+(t-a)*s)/(i*i+s*s);l>1?(r=o[0],a=o[1]):l>0&&(r+=i*l,a+=s*l)}return i=e-r,s=t-a,i*i+s*s}e(function(e,n,o){var a=Number.MIN_VALUE,i=0,s=void 0;if(e.length>1){for(var l=0;l<e.length;l++){var c=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:[e[l]]}}),u=Math.round(t(c));a<u&&(a=u,i=l)}s=[e[i]]}else s=e;return{center:r(s,n,o),index:i}}),n.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return--this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,n=this.compare,o=t[e];e>0;){var r=e-1>>1,a=t[r];if(n(o,a)>=0)break;t[e]=a,e=r}t[e]=o},_down:function(e){for(var t=this.data,n=this.compare,o=this.length>>1,r=t[e];e<o;){var a=1+(e<<1),i=a+1,s=t[a];if(i<this.length&&n(t[i],s)<0&&(a=i,s=t[i]),n(s,r)>=0)break;t[e]=s,e=a}t[e]=r}};var u=n}),ymaps.modules.define("parseZoomData",["util.array","config"],function(e,t,n){function o(e,t){e[t]=!0}function r(e,t){t.forEach(function(t){"number"==typeof t?(o(e,t),i(t)):"string"==typeof t&&a(e,t)})}function a(e,t){if(!isNaN(Number(t)))return e[Number(t)]=!0,void i(Number(t));var n=t.split("_").map(Number);if(isNaN(n[0])||isNaN(n[1]))return"err";for(var o=n[0]<l?l:n[0],r=n[1]>c?c:n[1];o<=r;)e[o]=!0,i(o),o++}function i(e){u&&f.push(e)}function s(){for(var e=l,t={};e<=c;)t[e]=!1,e++;return t}var l=n.MIN_ZOOM,c=n.MAX_ZOOM;e(function(e,n){u=n,f=[];var l=s();if("number"==typeof e)o(l,e),i(e);else if(t.isArray(e))r(l,e);else if("string"==typeof e&&"default"!==e&&"err"===a(l,e))return l;return u?f:l});var u=!1,f=[]}),ymaps.modules.define("setZoomVisibility",["checkPointPosition","config","parseZoomData"],function(e,t,n,o){function r(e,t,n,o){for(var r=s,c=l,u=void 0;r<c;)i(e,n,a(e,t,u=Math.floor((r+c)/2),o),u)?c=u:r=u+1;return r}function a(e,t,n,o){var r=e.options.get("projection").toGlobalPixels(t,n),a=o.width,i=o.height,s=[];return s.push([r[0]-a/2,r[1]-i/2],[r[0]-a/2,r[1]+i/2],[r[0]+a/2,r[1]-i/2],[r[0]+a/2,r[1]+i/2]),s}function i(e,n,o,r){for(var a=0;a<o.length;a++){var i=e.options.get("projection").fromGlobalPixels(o[a],r);if("INSIDE"!==t(i,n))return!1}return!0}var s=n.MIN_ZOOM,l=n.MAX_ZOOM;e(function(e,t,n,a,i){var s=o(i),l=n.geometry.getCoordinates()[t.polygonIndex],c=r(e,t.autoCenter,l,a);Object.keys(t.data).forEach(function(n){if(t.data[n].center){var o=r(e,t.data[n].center,l,a);t.data[n].visible=n>=o}else t.data[n].visible=n>=c;t.data[n].visibleForce=s[n]})})});