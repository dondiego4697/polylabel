ymaps.modules.define("setCenter",["getPolesOfInaccessibility","parseZoomData"],function(t,e,o){t(function(t,n,i){var a=i.labelCenterCoords,r=e(n.geometry.getCoordinates(),1);if(t.autoCenter=r.center,t.polygonIndex=r.index,"default"!==a){if("[object Object]"!==Object.prototype.toString.call(a))throw new Error("Center coords is not object");Object.keys(a).forEach(function(e){o(e,!0).forEach(function(o){t.data[o].center=a[e]})})}})}),ymaps.modules.define("config",[],function(t){t({MIN_ZOOM:0,MAX_ZOOM:19,options:["labelHtml","labelText","labelTextClassName","labelTextSize","outlineColor","textColor","maxFitTextSize"],properties:["labelCenterCoords"]})}),ymaps.modules.define("createLabel",[],function(t){t(function(t){var e=t.labelHtml,o=t.labelText,n=t.labelTextClassName,i=t.labelTextSize,a=t.outlineColor,r=t.textColor,l=void 0;if("default"!==e)l=e;else{var s=document.createElement("div");s.style.fontSize=i,s.style.color=r,s.style.textShadow="\n            1px 1px 0 "+a+",\n            -1px -1px 0 "+a+",\n            1px -1px 0 "+a+",\n            -1px 1px 0 "+a,s.innerHTML="default"!==o?o:null,"default"!==n&&(s.className=n),l=s}var c=ymaps.templateLayoutFactory.createClass("<div {% style %}position: {{properties.position}}; top: {{properties.top}}px;left: {{properties.left}}px; {% endstyle %}>$[properties.html]</div>");return new ymaps.Placemark([0,0],{html:l.outerHTML,top:0,left:0,position:"absolute"},{iconLayout:c})})}),ymaps.modules.define("createLabelLayout",[],function(t){t(function(){return ymaps.templateLayoutFactory.createClass("<div {% style %}position: {{properties.position}}; top: {{properties.top}}px;left: {{properties.left}}px; {% endstyle %}>$[properties.html]</div>")})}),ymaps.modules.define("Label",["util.extend"],function(t,e){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(e,n,i){o(this,t),this._geoObject=e,this._options=n,this._label=null,this._LayoutClass=i,this._initLabel()}return t.prototype.get=function(){return this._label},t.prototype.initEvents=function(){this._label.events.add("click",this.__labelClick,this)},t.prototype.culcLabelSize=function(t){var o=t.height/2,n=t.width/2;this._label=this._createLabel({properties:e({},this._label.properties.getAll(),{top:-o,left:-n}),options:{iconShape:{type:"Rectangle",coordinates:[[-n,-o],[n,o]]}}})},t.prototype._initLabel=function(){var t=this._options.labelHtml,e=void 0;e="default"!==t?t:this._createLabelWithPresets(),this._label=this._createLabel({properties:{html:e.outerHTML}})},t.prototype._createLabel=function(t){var o=t.properties,n=t.options;return o=e({},{top:0,left:0,position:"absolute"},o),n=e({},{iconLayout:this._LayoutClass},n),new ymaps.Placemark([0,0],o,n)},t.prototype._createLabelWithPresets=function(){var t=this._options,e=t.labelText,o=t.labelTextClassName,n=t.labelTextSize,i=t.outlineColor,a=t.textColor,r=document.createElement("div");return r.style.fontSize=n,r.style.color=a,r.style.textShadow="\n            1px 1px 0 "+i+",\n            -1px -1px 0 "+i+",\n            1px -1px 0 "+i+",\n            -1px 1px 0 "+i,r.innerHTML="default"!==e?e:null,"default"!==o&&(r.className=o),r},t.prototype.__labelClick=function(t){this._geoObject.events.fire("labelClick",{targetLabel:t.get("target")})},t.prototype._removeClickEvent=function(){this._label.events.remove("click",this.__labelClick,this)},t}())}),ymaps.modules.define("setPresets",["util.extend"],function(t,e){function o(t){var o=["big","small"],n=["blackInWhiteOutline","whiteInBlackOutline"];o.forEach(function(o){t.add(""+r+o,e({},a[o]))}),n.forEach(function(o){t.add(""+r+o,e({},a[o]))}),o.forEach(function(o){n.forEach(function(n){t.add(""+r+o+"|"+n,e({},a[o],a[n]))})})}function n(t){return{labelTextSize:t}}function i(t,e){return{textColor:t,outlineColor:e}}var a={big:n("20px"),small:n("12px"),blackInWhiteOutline:i("black","white"),whiteInBlackOutline:i("white","black")},r="polylabel#";t(function(t){var a=ymaps.option.presetStorage;t.options.set("preset","polylabel#default"),a.add("polylabel#default",e({},n("16px"),i("black"))),o(a)})}),ymaps.modules.define("util.polylabel",["Label","setCenter","createDefaultLabelData","setZoomVisibility","setPresets","config","createLabelLayout"],function(t,e,o,n,i,a,r,l){function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(e,o){s(this,t),this._map=e,this._collections=o,this._labelsCollections=new ymaps.GeoObjectCollection,this._map.geoObjects.add(this._labelsCollections),this._labelLayout=l(),this._initData()}return t.prototype.update=function(){this._calculateCollections(!0)},t.prototype.destroy=function(){this._labelsCollections.removeAll(),this._deleteListeners()},t.prototype._initData=function(){var t=this;a(this._collections),this._calculateCollections(!0).then(function(){t._initMapListeners(),t._initCollectionListeners()})},t.prototype._calculateCollections=function(t){var e=this;return new Promise(function(o){t&&e._clearLabelCollections(),e._collections.each(function(n){var i=void 0;t&&(i=new ymaps.GeoObjectCollection,e._labelsCollections.add(i)),n.each(function(o){t?e._calculateGeoObject(o,i).then(function(){e._analyseLabelData(o)}):e._analyseLabelData(o)}),o()})})},t.prototype._analyseLabelData=function(t){var e=t.properties.get("labelData"),o=e.data,n=e.autoCenter,i=e.label;(o=o[this._map.getZoom()]).visibleForce||o.visible?(i.geometry.setCoordinates(o.center||n),i.options.set({pane:"places"})):i.options.set({pane:"phantom"})},t.prototype._calculateGeoObject=function(t,a){var r=this,l=this._getOptions(t),s=this._getProperties(t),c=n();o(c,t,s);var u=new e(t,l,this._labelLayout);return a.add(u.get()),new Promise(function(e){u.get().getOverlay().then(function(t){return t.getLayout()}).then(function(o){var n=o._element.firstChild.getBoundingClientRect();a.remove(u.get()),u.culcLabelSize(n),a.add(u.get()),u.initEvents(),i(r._map,c,t,n,l.labelForceVisibleZoom),c.label=u.get(),t.properties.set("labelData",c),e()})})},t.prototype._getOptions=function(t){var e=r.options,o=t.options,n={};return e.forEach(function(t){n[t]=o.get(t,"default")}),n},t.prototype._getProperties=function(t){var e=r.properties,o=t.properties,n={};return e.forEach(function(t){n[t]=o.get(t,"default")}),n},t.prototype._clearLabelCollections=function(){this._labelsCollections.removeAll(),this._labelsCollections.options.set({pane:"phantom"})},t.prototype._initMapListeners=function(){this._map.events.add("boundschange",this.__mapBoundsChange,this)},t.prototype._initCollectionListeners=function(){this._collections.events.add(["add","remove"],this.__collectionEvents,this)},t.prototype.__mapBoundsChange=function(t){t.get("newZoom")!==t.get("oldZoom")&&this._calculateCollections()},t.prototype.__collectionEvents=function(t){switch(t.get("type")){case"add":case"remove":this._calculateCollections(!0)}},t.prototype._deleteListeners=function(){this._collections.events.remove(["add","remove"],this.__collectionEvents,this),this._map.events.remove("boundschange",this.__mapBoundsChange,this)},t}())}),ymaps.modules.define("calculateArea",[],function(t){function e(t){if("Feature"===t.type)return t.geometry;if(t.geometry&&t.geometry.getType)return"Circle"===t.geometry.getType()?{type:"Circle",coordinates:t.geometry.getCoordinates(),radius:t.geometry.getRadius()}:{type:t.geometry.getType(),coordinates:t.geometry.getCoordinates()};throw new Error("util.calculateArea: Unknown input object.")}function o(t){var e,o=0;switch(t.type){case"Polygon":return n(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)o+=n(t.coordinates[e]);return o;case"Rectangle":return n([[t.coordinates[0],[t.coordinates[0][0],t.coordinates[1][1]],t.coordinates[1],[t.coordinates[1][0],t.coordinates[0][1]],t.coordinates[0]]]);case"Circle":return Math.PI*Math.pow(t.radius,2);case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}}function n(t){var e=0;if(t&&t.length>0){e+=Math.abs(i(t[0]));for(var o=1;o<t.length;o++)e-=Math.abs(i(t[o]))}return e}function i(t){var e,o,n,i,l,s,c=0,u=t.length,p="latlong"===ymaps.meta.coordinatesOrder?1:0,f="latlong"===ymaps.meta.coordinatesOrder?0:1;if(u>2){for(s=0;s<u;s++)s===u-2?(n=u-2,i=u-1,l=0):s===u-1?(n=u-1,i=0,l=1):(n=s,i=s+1,l=s+2),e=t[n],o=t[i],c+=(a(t[l][p])-a(e[p]))*Math.sin(a(o[f]));c=c*r*r/2}return c}function a(t){return t*Math.PI/180}t(function(t){return o(e(t))});var r=6378137}),ymaps.modules.define("checkPointPosition",[],function(t){function e(t,e,a){var r=o(a,e),l=o(t,e),s=r[0]*l[1]-l[0]*r[1];return s>0?"LEFT":s<0?"RIGHT":r[0]*l[0]<0||r[1]*l[1]<0?"BEHIND":n(r)<n(l)?"BEYOND":i(e,t)?"ORIGIN":i(a,t)?"DESTINATION":"BETWEEN"}function o(t,e){return[t[0]-e[0],t[1]-e[1]]}function n(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}function i(t,e){return t[0]===e[0]&&t[1]===e[1]}function a(t,o){var n=o[0],i=o[1];switch(e(t,n,i)){case"LEFT":return n[1]<t[1]&&t[1]<=i[1]?"CROSSING":"INESSENTIAL";case"RIGHT":return i[1]<t[1]&&t[1]<=n[1]?"CROSSING":"INESSENTIAL";case"BETWEEN":case"ORIGIN":case"DESTINATION":return"TOUCHING";default:return"INESSENTIAL"}}t(function(t,e){for(var o=0,n=0;n<e.length-1;n++)switch(a(t,[e[n],e[n+1]])){case"TOUCHING":return"BOUNDARY";case"CROSSING":o=1-o}return o?"INSIDE":"OUTSIDE"})}),ymaps.modules.define("createDefaultLabelData",["config"],function(t,e){var o=e.MIN_ZOOM,n=e.MAX_ZOOM;t(function(){for(var t=o,e={data:{},autoCenter:[0,0],polygonIndex:0};t<=n;)e.data[t]={visible:!1,visibleForce:!1,center:null,maxFitTextSize:null},t++;return e})}),ymaps.modules.define("getPolesOfInaccessibility",["calculateArea"],function(t,e){function o(t,e){if(!(this instanceof o))return new o(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||n,this.length>0)for(var i=this.length>>1;i>=0;i--)this._down(i)}function n(t,e){return t<e?-1:t>e?1:0}function i(t,e,o){e=e||1;for(var n,i,l,c,p=0;p<t[0].length;p++){var f=t[0][p];(!p||f[0]<n)&&(n=f[0]),(!p||f[1]<i)&&(i=f[1]),(!p||f[0]>l)&&(l=f[0]),(!p||f[1]>c)&&(c=f[1])}var h=l-n,d=c-i,y=Math.min(h,d),m=y/2,b=new u(null,a);if(0===y)return[n,i];for(var v=n;v<l;v+=y)for(var g=i;g<c;g+=y)b.push(new r(v+m,g+m,m,t));var _=s(t),C=new r(n+h/2,i+d/2,0,t);C.d>_.d&&(_=C);for(var x=b.length;b.length;){var L=b.pop();L.d>_.d&&(_=L,o&&console.error("found best %d after %d probes",Math.round(1e4*L.d)/1e4,x)),L.max-_.d<=e||(m=L.h/2,b.push(new r(L.x-m,L.y-m,m,t)),b.push(new r(L.x+m,L.y-m,m,t)),b.push(new r(L.x-m,L.y+m,m,t)),b.push(new r(L.x+m,L.y+m,m,t)),x+=4)}return o&&(console.error("num probes: "+x),console.error("best distance: "+_.d)),[_.x,_.y]}function a(t,e){return e.max-t.max}function r(t,e,o,n){this.x=t,this.y=e,this.h=o,this.d=l(t,e,n),this.max=this.d+this.h*Math.SQRT2}function l(t,e,o){for(var n=!1,i=1/0,a=0;a<o.length;a++)for(var r=o[a],l=0,s=r.length,u=s-1;l<s;u=l++){var p=r[l],f=r[u];p[1]>e!=f[1]>e&&t<(f[0]-p[0])*(e-p[1])/(f[1]-p[1])+p[0]&&(n=!n),i=Math.min(i,c(t,e,p,f))}return(n?1:-1)*Math.sqrt(i)}function s(t){for(var e=0,o=0,n=0,i=t[0],a=0,l=i.length,s=l-1;a<l;s=a++){var c=i[a],u=i[s],p=c[0]*u[1]-u[0]*c[1];o+=(c[0]+u[0])*p,n+=(c[1]+u[1])*p,e+=3*p}return 0===e?new r(i[0][0],i[0][1],0,t):new r(o/e,n/e,0,t)}function c(t,e,o,n){var i=o[0],a=o[1],r=n[0]-i,l=n[1]-a;if(0!==r||0!==l){var s=((t-i)*r+(e-a)*l)/(r*r+l*l);s>1?(i=n[0],a=n[1]):s>0&&(i+=r*s,a+=l*s)}return r=t-i,l=e-a,r*r+l*l}t(function(t,o,n){var a=Number.MIN_VALUE,r=0,l=void 0;if(t.length>1){for(var s=0;s<t.length;s++){var c=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:[t[s]]}}),u=Math.round(e(c));a<u&&(a=u,r=s)}l=[t[r]]}else l=t;return{center:i(l,o,n),index:r}}),o.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return--this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,o=this.compare,n=e[t];t>0;){var i=t-1>>1,a=e[i];if(o(n,a)>=0)break;e[t]=a,t=i}e[t]=n},_down:function(t){for(var e=this.data,o=this.compare,n=this.length>>1,i=e[t];t<n;){var a=1+(t<<1),r=a+1,l=e[a];if(r<this.length&&o(e[r],l)<0&&(a=r,l=e[r]),o(l,i)>=0)break;e[t]=l,t=a}e[t]=i}};var u=o}),ymaps.modules.define("parseZoomData",["util.array","config"],function(t,e,o){function n(t,e){t[e]=!0,r(e)}function i(t,e){e.forEach(function(e){"number"==typeof e?n(t,e):"string"==typeof e&&a(t,e)})}function a(t,e){if(!isNaN(Number(e)))return t[Number(e)]=!0,void r(Number(e));var o=e.split("_").map(Number);if(isNaN(o[0])||isNaN(o[1]))return"err";for(var n=o[0]<s?s:o[0],i=o[1]>c?c:o[1];n<=i;)t[n]=!0,r(n),n++}function r(t){u&&p.push(t)}function l(){for(var t=s,e={};t<=c;)e[t]=!1,t++;return e}var s=o.MIN_ZOOM,c=o.MAX_ZOOM;t(function(t,o){u=o,p=[];var r=l();if("number"==typeof t)n(r,t);else if(e.isArray(t))i(r,t);else if("string"==typeof t&&"default"!==t&&"err"===a(r,t))return r;return u?p:r});var u=!1,p=[]}),ymaps.modules.define("setZoomVisibility",["checkPointPosition","config","parseZoomData"],function(t,e,o,n){function i(t,e,n,i){for(var l=o.MIN_ZOOM,s=o.MAX_ZOOM,c=void 0;l<s;)r(t,n,a(t,e,c=Math.floor((l+s)/2),i),c)?s=c:l=c+1;return l}function a(t,e,o,n){var i=t.options.get("projection").toGlobalPixels(e,o),a=n.width,r=n.height,l=[];return l.push([i[0]-a/2,i[1]-r/2],[i[0]-a/2,i[1]+r/2],[i[0]+a/2,i[1]-r/2],[i[0]+a/2,i[1]+r/2]),l}function r(t,o,n,i){for(var a=0;a<n.length;a++){var r=t.options.get("projection").fromGlobalPixels(n[a],i);if("INSIDE"!==e(r,o))return!1}return!0}t(function(t,e,o,a,r){var l=n(r),s=o.geometry.getCoordinates()[e.polygonIndex],c=i(t,e.autoCenter,s,a);Object.keys(e.data).forEach(function(o){if(e.data[o].center){var n=i(t,e.data[o].center,s,a);e.data[o].visible=o>=n}else e.data[o].visible=o>=c;e.data[o].visibleForce=l[o]})})});