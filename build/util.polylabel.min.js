ymaps.modules.define("setCenter",["util.array","util.objectKeys","getPolesOfInaccessibility","parseZoomData"],function(t,e,o,n,i){t(function(t,a,r){var l=r.labelCenterCoords,s=n(a.geometry.getCoordinates(),1);if(t.autoCenter=s.center,t.polygonIndex=s.index,e.isArray(l))o(t.zoomInfo).forEach(function(e){t.zoomInfo[e].center=l});else if("[object Object]"===Object.prototype.toString.call(l)){var c=i(l);o(c).forEach(function(e){void 0!==c[e]&&(t.zoomInfo[e].center=c[e])})}})}),ymaps.modules.define("config",[],function(t){t({MIN_ZOOM:0,MAX_ZOOM:19,options:["labelHtml","labelText","labelForceVisibleZoom","labelTextClassName","labelTextSize","outlineColor","textColor","maxFitTextSize"],properties:["labelCenterCoords"]})}),ymaps.modules.define("createLabelLayout",["templateLayoutFactory"],function(t,e){t(e.createClass("<div {% style %}position: {{properties.position}}; top: {{properties.top}}px;left: {{properties.left}}px; {% endstyle %}>$[properties.html]</div>"))}),ymaps.modules.define("Label",["util.extend","stringReplacer"],function(t,e,o){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(e,o,i,a){if(n(this,t),!e||!i||!a)throw new Error("wrong argument");this._geoObject=e,this._parentCollection=a,this._options=o,this._label=null,this._LayoutClass=i,this._initLabel()}return t.prototype.getPlacemark=function(){return this._label},t.prototype.calculateLabelSize=function(o){this.removeFromCollection();var n=o.height/2,i=o.width/2;this._label=t._createPlacemark({properties:e({},this._label.properties.getAll(),{top:-n,left:-i}),options:e({},this._label.options.getAll(),{iconShape:{type:"Rectangle",coordinates:[[-i,-n],[i,n]]}})},this._LayoutClass),this.addToCollection()},t.prototype.removeFromCollection=function(){if(!this._parentCollection)return!1;this._parentCollection.remove(this._label)},t.prototype.addToCollection=function(){if(!this._parentCollection)return!1;this._parentCollection.add(this._label)},t.prototype._initLabel=function(){var e=this._options.labelHtml,o=void 0;o=e||this._createLabelContentWithPresets(),this._label=t._createPlacemark({properties:{html:o},options:this._options},this._LayoutClass)},t._createPlacemark=function(t,o){var n=t.properties,i=t.options;return n=e({},{top:0,left:0,position:"absolute"},n),i=e({},{iconLayout:o},i),new ymaps.Placemark([0,0],n,i)},t.prototype._createLabelContentWithPresets=function(){var t=this._options,e=t.labelText,n=t.labelTextClassName,i=t.labelTextSize,a=t.outlineColor,r=t.textColor;return o('<div class="$1" style="font-size: $2; color: $3; text-shadow: $4">$5</div>',[n,i,r,"\n        1px 1px 0 "+a+",\n        -1px -1px 0 "+a+",\n        1px -1px 0 "+a+",\n        -1px 1px 0 "+a,e])},t.prototype._initEvents=function(){this._label.events.add("click",this._labelClick,this)},t.prototype._labelClick=function(){this._geoObject.events.fire("labelClick",{targetLabel:this._label})},t.prototype._removeClickEvent=function(){this._label.events.remove("click",this._labelClick,this)},t.prototype.destroy=function(){this._removeClickEvent(),this.removeFromCollection(),this._label=null},t}())}),ymaps.modules.define("setPresets",["util.extend"],function(t,e){function o(t){var o=["Big","Small"],n=["BlackInWhiteOutline","WhiteInBlackOutline"];o.forEach(function(o){t.add(""+r+o,e({},a[o]))}),n.forEach(function(o){t.add(""+r+o,e({},a[o]))}),o.forEach(function(o){n.forEach(function(n){t.add(""+r+o+n,e({},a[o],a[n]))})})}function n(t){return{labelTextSize:t}}function i(t,e){return{textColor:t,outlineColor:e}}var a={Big:n("20px"),Small:n("12px"),BlackInWhiteOutline:i("black","white"),HhiteInBlackOutline:i("white","black")},r="polylabel#";t(function(t){var a=ymaps.option.presetStorage;t.options.set("preset","polylabel#default"),a.add("polylabel#default",e({},n("16px"),i("black"))),o(a)})}),ymaps.modules.define("util.polylabel",["Label","setCenter","createDefaultLabelData","setZoomVisibility","setPresets","config","createLabelLayout","getMaxFitTextSize"],function(t,e,o,n,i,a,r,l,s){function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t(function(){function t(e,o,n){c(this,t),this._map=e,this._polygonsCollection=n,this._labelsCollection=o,this._labelLayout=l,this._initData()}return t.prototype.update=function(){this._calculateCollections(!0)},t.prototype.destroy=function(){this._labelsCollection.removeAll(),this._deleteListeners()},t.prototype._initData=function(){var t=this;a(this._labelsCollection),this._calculateCollections(!0).then(function(){t._initMapListeners(),t._initCollectionListeners()})},t.prototype._calculateCollections=function(t){var e=this;return new Promise(function(o){t&&e._clearLabelCollections(),e._polygonsCollection.each(function(o){t?e._calculateGeoObject(o).then(function(){e._calculateAndSetLabelData(o)}):e._calculateAndSetLabelData(o)}),o()})},t.prototype._calculateAndSetLabelData=function(t){var e=t.properties.get("_labelData");if(e){var o=e.zoomInfo,n=e.autoCenter,i=e.label;o=o[this._map.getZoom()],(i=i.getPlacemark()).geometry.setCoordinates(o.center||n);var a=void 0===o.visibleForce?o.visible:o.visibleForce;i.options.set({pane:a?"places":"phantom"})}},t.prototype._calculateGeoObject=function(t){var a=this,r=this._getOptions(t),l=this._getProperties(t),s=n();o(s,t,l);var c=new e(t,r,this._labelLayout,this._labelsCollection);return c.addToCollection(),c.getPlacemark().getOverlay().then(function(t){return t.getLayout()}).then(function(e){var o=e.getElement().firstChild.getBoundingClientRect();c.calculateLabelSize(o),c._initEvents(),i(a._map,s,t,o,r.labelForceVisibleZoom),s.label=c,t.properties.set("_labelData",s)})},t.prototype._recalculateGeoObject=function(t){var e=this;this._calculateGeoObject(t).then(function(){e._calculateAndSetLabelData(t)})},t.prototype._getOptions=function(t){var e={};return r.options.forEach(function(o){e[o]=t.options.get(o)}),e},t.prototype._getProperties=function(t){var e={};return r.properties.forEach(function(o){e[o]=t.properties.get(o)}),e},t.prototype._clearLabelCollections=function(){this._labelsCollection.removeAll(),this._labelsCollection.options.set({pane:"phantom"})},t.prototype._initCollectionListeners=function(){this._polygonsCollection.events.add(["add","remove"],this._onCollectionEvents,this)},t.prototype._onMapBoundsChange=function(t){t.get("newZoom")!==t.get("oldZoom")&&this._calculateCollections()},t.prototype._onCollectionEvents=function(t){switch(console.log(t),t.get("type")){case"add":this._recalculateGeoObject(t.get("child"));break;case"remove":t.get("child").properties.get("_labelData").label.destroy()}},t.prototype._initMapListeners=function(){this._map.events.add("boundschange",this._onMapBoundsChange,this)},t.prototype._deleteListeners=function(){this._polygonsCollection.events.remove(["add","remove"],this._onCollectionEvents,this),this._map.events.remove("boundschange",this._onMapBoundsChange,this)},t}())}),ymaps.modules.define("checkPointPosition",[],function(t){function e(t,e,a){var r=o(a,e),l=o(t,e),s=r[0]*l[1]-l[0]*r[1];return s>0?"LEFT":s<0?"RIGHT":r[0]*l[0]<0||r[1]*l[1]<0?"BEHIND":n(r)<n(l)?"BEYOND":i(e,t)?"ORIGIN":i(a,t)?"DESTINATION":"BETWEEN"}function o(t,e){return[t[0]-e[0],t[1]-e[1]]}function n(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}function i(t,e){return t[0]===e[0]&&t[1]===e[1]}function a(t,o){var n=o[0],i=o[1];switch(e(t,n,i)){case"LEFT":return n[1]<t[1]&&t[1]<=i[1]?"CROSSING":"INESSENTIAL";case"RIGHT":return i[1]<t[1]&&t[1]<=n[1]?"CROSSING":"INESSENTIAL";case"BETWEEN":case"ORIGIN":case"DESTINATION":return"TOUCHING";default:return"INESSENTIAL"}}t(function(t,e){for(var o=0,n=0;n<e.length-1;n++)switch(a(t,[e[n],e[n+1]])){case"TOUCHING":return"BOUNDARY";case"CROSSING":o=1-o}return o?"INSIDE":"OUTSIDE"})}),ymaps.modules.define("createDefaultLabelData",["config"],function(t,e){var o=e.MIN_ZOOM,n=e.MAX_ZOOM;t(function(){for(var t=o,e={zoomInfo:{},autoCenter:[0,0],polygonIndex:0};t<=n;)e.zoomInfo[t]={visible:!1,visibleForce:void 0,center:void 0,maxFitTextSize:void 0},t++;return e})}),ymaps.modules.define("getMaxFitTextSize",[],function(t){t(function(t){console.log(t)})}),ymaps.modules.define("getPolesOfInaccessibility",["util.calculateArea"],function(t,e){function o(t,e){if(!(this instanceof o))return new o(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||n,this.length>0)for(var i=this.length>>1;i>=0;i--)this._down(i)}function n(t,e){return t<e?-1:t>e?1:0}function i(t,e,o){e=e||1;for(var n,i,l,c,p=0;p<t[0].length;p++){var f=t[0][p];(!p||f[0]<n)&&(n=f[0]),(!p||f[1]<i)&&(i=f[1]),(!p||f[0]>l)&&(l=f[0]),(!p||f[1]>c)&&(c=f[1])}var h=l-n,d=c-i,m=Math.min(h,d),b=m/2,v=new u(null,a);if(0===m)return[n,i];for(var _=n;_<l;_+=m)for(var y=i;y<c;y+=m)v.push(new r(_+b,y+b,b,t));var g=s(t),C=new r(n+h/2,i+d/2,0,t);C.d>g.d&&(g=C);for(var I=v.length;v.length;){var x=v.pop();x.d>g.d&&(g=x,o&&console.error("found best %d after %d probes",Math.round(1e4*x.d)/1e4,I)),x.max-g.d<=e||(b=x.h/2,v.push(new r(x.x-b,x.y-b,b,t)),v.push(new r(x.x+b,x.y-b,b,t)),v.push(new r(x.x-b,x.y+b,b,t)),v.push(new r(x.x+b,x.y+b,b,t)),I+=4)}return o&&(console.error("num probes: "+I),console.error("best distance: "+g.d)),[g.x,g.y]}function a(t,e){return e.max-t.max}function r(t,e,o,n){this.x=t,this.y=e,this.h=o,this.d=l(t,e,n),this.max=this.d+this.h*Math.SQRT2}function l(t,e,o){for(var n=!1,i=1/0,a=0;a<o.length;a++)for(var r=o[a],l=0,s=r.length,u=s-1;l<s;u=l++){var p=r[l],f=r[u];p[1]>e!=f[1]>e&&t<(f[0]-p[0])*(e-p[1])/(f[1]-p[1])+p[0]&&(n=!n),i=Math.min(i,c(t,e,p,f))}return(n?1:-1)*Math.sqrt(i)}function s(t){for(var e=0,o=0,n=0,i=t[0],a=0,l=i.length,s=l-1;a<l;s=a++){var c=i[a],u=i[s],p=c[0]*u[1]-u[0]*c[1];o+=(c[0]+u[0])*p,n+=(c[1]+u[1])*p,e+=3*p}return 0===e?new r(i[0][0],i[0][1],0,t):new r(o/e,n/e,0,t)}function c(t,e,o,n){var i=o[0],a=o[1],r=n[0]-i,l=n[1]-a;if(0!==r||0!==l){var s=((t-i)*r+(e-a)*l)/(r*r+l*l);s>1?(i=n[0],a=n[1]):s>0&&(i+=r*s,a+=l*s)}return r=t-i,l=e-a,r*r+l*l}t(function(t,o,n){if(void 0===e)throw new Error("Didn't find calculateArea module");var a=Number.MIN_VALUE,r=0,l=void 0;if(t.length>1){for(var s=0;s<t.length;s++){var c=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:[t[s]]}}),u=Math.round(e(c));a<u&&(a=u,r=s)}l=[t[r]]}else l=t;return{center:i(l,o,n),index:r}}),o.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return--this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,o=this.compare,n=e[t];t>0;){var i=t-1>>1,a=e[i];if(o(n,a)>=0)break;e[t]=a,t=i}e[t]=n},_down:function(t){for(var e=this.data,o=this.compare,n=this.length>>1,i=e[t];t<n;){var a=1+(t<<1),r=a+1,l=e[a];if(r<this.length&&o(e[r],l)<0&&(a=r,l=e[r]),o(l,i)>=0)break;e[t]=l,t=a}e[t]=i}};var u=o}),ymaps.modules.define("stringReplacer",[],function(t){t(function(t,e){var o=t;return e.forEach(function(t,e){o=o.replace(new RegExp("\\$"+(e+1),"g"),t)}),o})}),ymaps.modules.define("parseZoomData",["util.objectKeys","config"],function(t,e,o){function n(t,e,o){t[e]=o}function i(t,e,o){if(isNaN(Number(e))){var n=e.split("_").map(Number);if(!isNaN(n[0])&&!isNaN(n[1]))for(var i=n[0]<r?r:n[0],a=n[1]>l?l:n[1];i<=a;)t[i]=o,i++}else t[Number(e)]=o}function a(){for(var t=r,e={};t<=l;)e[t]=void 0,t++;return e}var r=o.MIN_ZOOM,l=o.MAX_ZOOM;t(function(t){var o=a();return e(t).forEach(function(e){"string"==typeof e?i(o,e,t[e]):"number"==typeof e&&n(o,e,t[e])}),o})}),ymaps.modules.define("setZoomVisibility",["util.objectKeys","checkPointPosition","config","parseZoomData"],function(t,e,o,n,i){function a(t,o){if("boolean"==typeof o)e(t.zoomInfo).forEach(function(e){t.zoomInfo[e].visibleForce=o});else if("[object Object]"===Object.prototype.toString.call(o)){var n=i(o);e(n).forEach(function(e){void 0!==n[e]&&(t.zoomInfo[e].visibleForce=n[e])})}}function r(t,e,o,i){for(var a=n.MIN_ZOOM,r=n.MAX_ZOOM,c=void 0;a<r;)s(t,o,l(t,e,c=Math.floor((a+r)/2),i),c)?r=c:a=c+1;return a}function l(t,e,o,n){var i=t.options.get("projection").toGlobalPixels(e,o),a=n.width,r=n.height,l=[];return l.push([i[0]-a/2,i[1]-r/2],[i[0]-a/2,i[1]+r/2],[i[0]+a/2,i[1]-r/2],[i[0]+a/2,i[1]+r/2]),l}function s(t,e,n,i){for(var a=0;a<n.length;a++){var r=t.options.get("projection").fromGlobalPixels(n[a],i);if("INSIDE"!==o(r,e))return!1}return!0}t(function(t,o,n,i,l){a(o,l);var s=n.geometry.getCoordinates()[o.polygonIndex],c=r(t,o.autoCenter,s,i);e(o.zoomInfo).forEach(function(e){if(o.zoomInfo[e].center){var n=r(t,o.zoomInfo[e].center,s,i);o.zoomInfo[e].visible=e>=n}else o.zoomInfo[e].visible=e>=c})})});