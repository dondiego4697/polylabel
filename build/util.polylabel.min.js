ymaps.modules.define("util.calculateArea",[],function(t){function e(t){if("Feature"==t.type)return t.geometry;if(t.geometry&&t.geometry.getType)return"Circle"==t.geometry.getType()?{type:"Circle",coordinates:t.geometry.getCoordinates(),radius:t.geometry.getRadius()}:{type:t.geometry.getType(),coordinates:t.geometry.getCoordinates()};throw new Error("util.calculateArea: Unknown input object.")}function n(t){var e,n=0;switch(t.type){case"Polygon":return r(t.coordinates);case"MultiPolygon":for(e=0;e<t.coordinates.length;e++)n+=r(t.coordinates[e]);return n;case"Rectangle":return r([[t.coordinates[0],[t.coordinates[0][0],t.coordinates[1][1]],t.coordinates[1],[t.coordinates[1][0],t.coordinates[0][1]],t.coordinates[0]]]);case"Circle":return Math.PI*Math.pow(t.radius,2);case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}}function r(t){var e=0;if(t&&t.length>0){e+=Math.abs(a(t[0]));for(var n=1;n<t.length;n++)e-=Math.abs(a(t[n]))}return e}function a(t){var e,n,r,a,s,u,c=0,h=t.length,l="latlong"==ymaps.meta.coordinatesOrder?1:0,d="latlong"==ymaps.meta.coordinatesOrder?0:1;if(h>2){for(u=0;u<h;u++)u===h-2?(r=h-2,a=h-1,s=0):u===h-1?(r=h-1,a=0,s=1):(r=u,a=u+1,s=u+2),e=t[r],n=t[a],c+=(o(t[s][l])-o(e[l]))*Math.sin(o(n[d]));c=c*i*i/2}return c}function o(t){return t*Math.PI/180}var i=6378137;t(function(t){return n(e(t))})}),ymaps.modules.define("checkPointPosition",[],function(t){function e(t,e,o){var i=n(o,e),s=n(t,e),u=i[0]*s[1]-s[0]*i[1];return u>0?"LEFT":u<0?"RIGHT":i[0]*s[0]<0||i[1]*s[1]<0?"BEHIND":r(i)<r(s)?"BEYOND":a(e,t)?"ORIGIN":a(o,t)?"DESTINATION":"BETWEEN"}function n(t,e){return[t[0]-e[0],t[1]-e[1]]}function r(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2))}function a(t,e){return t[0]===e[0]&&t[1]===e[1]}function o(t,n){var r=n[0],a=n[1];switch(e(t,r,a)){case"LEFT":return r[1]<t[1]&&t[1]<=a[1]?"CROSSING":"INESSENTIAL";case"RIGHT":return a[1]<t[1]&&t[1]<=r[1]?"CROSSING":"INESSENTIAL";case"BETWEEN":case"ORIGIN":case"DESTINATION":return"TOUCHING";default:return"INESSENTIAL"}}t(function(t,e){for(var n=0,r=0;r<e.length-1;r++)switch(o(t,[e[r],e[r+1]])){case"TOUCHING":return"BOUNDARY";case"CROSSING":n=1-n}return n?"INSIDE":"OUTSIDE"})}),ymaps.modules.define("util.polylabel",["getPolyLabelCenter","util.nodeSize","checkPointPosition"],function(t,e,n,r){function a(t,e,n){var a=ymaps.projection.sphericalMercator.toGlobalPixels(t,n),o=i.w,s=i.h,u=[];u.push([a[0]-o/2,a[1]-s/2]),u.push([a[0]-o/2,a[1]+s/2]),u.push([a[0]+o/2,a[1]-s/2]),u.push([a[0]+o/2,a[1]+s/2]);for(var c=0;c<u.length;c++){var h=ymaps.projection.sphericalMercator.fromGlobalPixels(u[c],n);if("INSIDE"!==r(h,e))return!1}return!0}var o=function(){var t=document.createElement("div");return t.style.display="inline-block",document.body.appendChild(t),t}(),i=function(){var t=document.createElement("h6");return t.innerText="asdasddsasdasdasdasdas",o.appendChild(t),{w:t.clientWidth,h:t.clientHeight}}();o.style.display="none",t(function(t,n){if(!t instanceof Array)throw new Error("Wrong params");var r=e(t,1);return a(r.center,t[r.index],n),{center:r.center,isInclude:a(r.center,t[r.index],n)}})}),ymaps.modules.define("getPolyLabelCenter",["util.calculateArea"],function(t,e){function n(t,e){if(!(this instanceof n))return new n(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||r,this.length>0)for(var a=this.length>>1;a>=0;a--)this._down(a)}function r(t,e){return t<e?-1:t>e?1:0}function a(t,e,n){e=e||1;for(var r,a,s,c,l=0;l<t[0].length;l++){var d=t[0][l];(!l||d[0]<r)&&(r=d[0]),(!l||d[1]<a)&&(a=d[1]),(!l||d[0]>s)&&(s=d[0]),(!l||d[1]>c)&&(c=d[1])}var f=s-r,p=c-a,g=Math.min(f,p),y=g/2,m=new h(null,o);if(0===g)return[r,a];for(var v=r;v<s;v+=g)for(var I=a;I<c;I+=g)m.push(new i(v+y,I+y,y,t));var w=u(t),E=new i(r+f/2,a+p/2,0,t);E.d>w.d&&(w=E);for(var N=m.length;m.length;){var M=m.pop();M.d>w.d&&(w=M,n&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,N)),M.max-w.d<=e||(y=M.h/2,m.push(new i(M.x-y,M.y-y,y,t)),m.push(new i(M.x+y,M.y-y,y,t)),m.push(new i(M.x-y,M.y+y,y,t)),m.push(new i(M.x+y,M.y+y,y,t)),N+=4)}return n&&(console.log("num probes: "+N),console.log("best distance: "+w.d)),[w.x,w.y]}function o(t,e){return e.max-t.max}function i(t,e,n,r){this.x=t,this.y=e,this.h=n,this.d=s(t,e,r),this.max=this.d+this.h*Math.SQRT2}function s(t,e,n){for(var r=!1,a=1/0,o=0;o<n.length;o++)for(var i=n[o],s=0,u=i.length,h=u-1;s<u;h=s++){var l=i[s],d=i[h];l[1]>e!=d[1]>e&&t<(d[0]-l[0])*(e-l[1])/(d[1]-l[1])+l[0]&&(r=!r),a=Math.min(a,c(t,e,l,d))}return(r?1:-1)*Math.sqrt(a)}function u(t){for(var e=0,n=0,r=0,a=t[0],o=0,s=a.length,u=s-1;o<s;u=o++){var c=a[o],h=a[u],l=c[0]*h[1]-h[0]*c[1];n+=(c[0]+h[0])*l,r+=(c[1]+h[1])*l,e+=3*l}return 0===e?new i(a[0][0],a[0][1],0,t):new i(n/e,r/e,0,t)}function c(t,e,n,r){var a=n[0],o=n[1],i=r[0]-a,s=r[1]-o;if(0!==i||0!==s){var u=((t-a)*i+(e-o)*s)/(i*i+s*s);u>1?(a=r[0],o=r[1]):u>0&&(a+=i*u,o+=s*u)}return i=t-a,s=e-o,i*i+s*s}n.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return--this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var a=t-1>>1,o=e[a];if(n(r,o)>=0)break;e[t]=o,t=a}e[t]=r},_down:function(t){for(var e=this.data,n=this.compare,r=this.length>>1,a=e[t];t<r;){var o=1+(t<<1),i=o+1,s=e[o];if(i<this.length&&n(e[i],s)<0&&(o=i,s=e[i]),n(s,a)>=0)break;e[t]=s,t=o}e[t]=a}};var h=n;t(function(t,n,r){var o,i=Number.MIN_VALUE,s=0;if(t.length>1){for(var u=0;u<t.length;u++){var c=new ymaps.GeoObject({geometry:{type:"Polygon",coordinates:[t[u]]}}),h=Math.round(e(c));i<h&&(i=h,s=u)}o=[t[s]]}else o=t;return{center:a(o,n,r),index:s}})});